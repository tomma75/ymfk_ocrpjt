<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOKOGAWA OCR ë°ì´í„° ì¤€ë¹„ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            text-align: center;
            font-size: 2.2rem;
        }
        
        .header p {
            text-align: center;
            margin-top: 10px;
            opacity: 0.8;
        }
        
        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            background: white;
            border: 1px solid #ddd;
            border-bottom: none;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px 5px 0 0;
        }
        
        .tab:hover {
            background-color: #f8f9fa;
        }
        
        .tab.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ì„œë¹„ìŠ¤ ìƒíƒœ */
        .status-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .service-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .service-card {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .service-card h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .service-card.active {
            border-color: #27ae60;
            background-color: #f0fff4;
        }
        
        .service-card.active .status-icon {
            color: #27ae60;
        }
        
        .service-card.inactive {
            border-color: #e74c3c;
            background-color: #fff5f5;
        }
        
        .service-card.inactive .status-icon {
            color: #e74c3c;
        }
        
        .status-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        /* íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ */
        .upload-section {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 40px;
            margin: 20px 0;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background-color: #e3f2fd;
            border-color: #2196f3;
        }
        
        .upload-area.dragover {
            background-color: #e3f2fd;
            border-color: #2196f3;
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #3498db;
            margin-bottom: 10px;
        }
        
        #fileInput {
            display: none;
        }
        
        /* íŒŒì´í”„ë¼ì¸ ì„¹ì…˜ */
        .pipeline-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn-success {
            background-color: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #229954;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* íŒŒì¼ ëª©ë¡ */
        .files-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        
        .file-list {
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .file-item {
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border-left: 4px solid #ddd;
        }
        
        .file-item:hover {
            background-color: #f8f9fa;
            border-color: #3498db;
            transform: translateX(2px);
        }
        
        .file-item.complete {
            background-color: #e6f4ff;  /* íŒŒìŠ¤í…” í•˜ëŠ˜ìƒ‰ */
            border-color: #91d5ff;
            border-left-color: #4caf50;
        }
        
        .file-item.in-progress {
            background-color: #fff8e1;  /* ì—°í•œ ë…¸ë€ìƒ‰ */
            border-color: #ffecb3;
            border-left-color: #ff9800;
        }
        
        .file-item.not-started {
            background-color: #ffebee;  /* ì—°í•œ ë¹¨ê°„ìƒ‰ */
            border-color: #ffcdd2;
            border-left-color: #f44336;
        }
        
        .file-item.complete:hover {
            background-color: #d0ebff;
            border-color: #69c0ff;
        }
        
        .file-status {
            display: inline-flex;
            gap: 15px;
            margin-top: 5px;
            font-size: 0.85rem;
        }
        
        .status-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 500;
        }
        
        .status-badge.split {
            background-color: #f0f0f0;
            color: #666;
        }
        
        .status-badge.label {
            background-color: #fff7e6;
            color: #d48806;
        }
        
        .status-badge.complete {
            background-color: #d4f8d4;
            color: #52c41a;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        /* ì§„í–‰ ìƒí™© */
        .progress {
            background-color: #e0e0e0;
            border-radius: 20px;
            height: 25px;
            margin-top: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #3498db, #2ecc71);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
            text-align: center;
            color: white;
            line-height: 25px;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* ì•Œë¦¼ */
        .alert {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .alert-close {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            opacity: 0.5;
        }
        
        .alert-close:hover {
            opacity: 1;
        }
        
        /* ë¡œë”© */
        #loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ë¼ë²¨ë§ í¸ì§‘ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .labeling-editor {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .label-form {
            display: grid;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        /* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° */
        .image-preview {
            position: relative;
            flex: 1;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            overflow: auto;
            max-height: calc(100vh - 400px);
        }
        
        .image-container {
            position: relative;
            display: inline-block;
            min-width: 100%;
        }
        
        .image-preview img {
            width: auto;
            height: auto;
            max-width: none;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: block;
        }
        
        /* Bounding box ì˜¤ë²„ë ˆì´ */
        .bbox-overlay {
            position: absolute;
            border: 2px solid #ff0000;
            background-color: rgba(255, 0, 0, 0.1);
            cursor: move;
        }
        
        .bbox-overlay .resize-handle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #fff;
            border: 2px solid #ff0000;
            border-radius: 50%;
        }
        
        .bbox-overlay .resize-handle.nw { top: -4px; left: -4px; cursor: nw-resize; }
        .bbox-overlay .resize-handle.ne { top: -4px; right: -4px; cursor: ne-resize; }
        .bbox-overlay .resize-handle.sw { bottom: -4px; left: -4px; cursor: sw-resize; }
        .bbox-overlay .resize-handle.se { bottom: -4px; right: -4px; cursor: se-resize; }
        
        .bbox-overlay:hover {
            background-color: rgba(255, 0, 0, 0.3);
        }
        
        .bbox-overlay.selected {
            border-color: #0066ff;
            background-color: rgba(0, 102, 255, 0.2);
        }
        
        .bbox-overlay.suggested {
            border-color: #00cc00;
            background-color: rgba(0, 204, 0, 0.1);
            border-style: dashed;
        }
        
        .bbox-overlay.suggested:hover {
            background-color: rgba(0, 204, 0, 0.3);
        }
        
        .bbox-label {
            position: absolute;
            background: #ff0000;
            color: white;
            padding: 2px 6px;
            font-size: 12px;
            top: -20px;
            left: 0;
            border-radius: 3px;
        }
        
        .bbox-overlay.suggested .bbox-label {
            background: #00cc00;
        }
        
        .confidence-badge {
            position: absolute;
            bottom: -20px;
            right: 0;
            background: #333;
            color: white;
            padding: 2px 6px;
            font-size: 11px;
            border-radius: 3px;
        }
        
        /* ë¼ë²¨ë§ í¸ì§‘ ì»¨í…Œì´ë„ˆ */
        .labeling-main-layout {
            display: grid;
            grid-template-columns: 250px 1fr 350px;
            gap: 20px;
            margin-top: 20px;
            height: calc(100vh - 300px);
            min-height: 600px;
        }
        
        .labeling-controls-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
        }
        
        .labeling-controls-section h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .labeling-controls-section .btn {
            width: 100%;
            text-align: left;
            justify-content: flex-start;
        }
        
        .labeling-image-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .labeling-form-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow-y: auto;
        }
        
        .bbox-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .bbox-item.selected {
            border-color: #0066ff;
            background: #e7f1ff;
        }
        
        .bbox-controls {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        
        .drawing-tools {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }
        
        /* ë¼ë²¨ ë²„íŠ¼ ê·¸ë£¹ */
        .label-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .label-buttons .btn-label {
            padding: 10px;
            font-size: 13px;
            background: white;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        .label-buttons .btn-label:hover {
            background: #e7f1ff;
            border-color: #3498db;
        }
        
        /* í†µê³„ ì¹´ë“œ */
        .stats-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        /* PDF í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ */
        .pdf-navigation {
            display: none;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .pdf-navigation.visible {
            display: block;
        }
        
        .page-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        
        .page-info {
            font-weight: 500;
            font-size: 16px;
        }
        
        .page-controls .btn {
            padding: 8px 16px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>YOKOGAWA OCR ë°ì´í„° ì¤€ë¹„ ì‹œìŠ¤í…œ</h1>
            <p>PDF ë¬¸ì„œ OCR ë° í•™ìŠµ ë°ì´í„° ì¤€ë¹„ í”Œë«í¼</p>
        </div>
    </div>
    
    <div class="container">
        <div id="alerts"></div>
        
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('dashboard')">ëŒ€ì‹œë³´ë“œ</div>
            <div class="tab" onclick="showTab('upload')">íŒŒì¼ ì—…ë¡œë“œ</div>
            <div class="tab" onclick="showTab('labeling')">ë¼ë²¨ë§ í¸ì§‘</div>
            <div class="tab" onclick="showTab('statistics')">í†µê³„</div>
        </div>
        
        <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
        <div id="dashboard" class="tab-content active">
            <!-- ì„œë¹„ìŠ¤ ìƒíƒœ ì„¹ì…˜ -->
            <div class="status-section">
                <h2>ì„œë¹„ìŠ¤ ìƒíƒœ</h2>
                <div class="service-status" id="serviceStatus">
                    <div class="service-card">
                        <div class="status-icon">ğŸ“Š</div>
                        <h3>ë°ì´í„° ìˆ˜ì§‘</h3>
                        <p id="collectionStatus">í™•ì¸ ì¤‘...</p>
                    </div>
                    <div class="service-card">
                        <div class="status-icon">ğŸ·ï¸</div>
                        <h3>ë¼ë²¨ë§</h3>
                        <p id="labelingStatus">í™•ì¸ ì¤‘...</p>
                    </div>
                    <div class="service-card">
                        <div class="status-icon">ğŸ”„</div>
                        <h3>ë°ì´í„° ì¦ê°•</h3>
                        <p id="augmentationStatus">í™•ì¸ ì¤‘...</p>
                    </div>
                    <div class="service-card">
                        <div class="status-icon">âœ…</div>
                        <h3>ê²€ì¦</h3>
                        <p id="validationStatus">í™•ì¸ ì¤‘...</p>
                    </div>
                </div>
            </div>
            
            <!-- ë©”ì¸ ì»¨í…ì¸  ê·¸ë¦¬ë“œ -->
            <div class="dashboard-grid">
                <!-- ì™¼ìª½: íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ì„¹ì…˜ -->
                <div class="pipeline-section">
                    <h2>íŒŒì´í”„ë¼ì¸ ì‹¤í–‰</h2>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runPipeline('collection')">
                            <span>ğŸ“Š</span> ë°ì´í„° ìˆ˜ì§‘ë§Œ ì‹¤í–‰
                        </button>
                        <button class="btn btn-primary" onclick="runPipeline('labeling')">
                            <span>ğŸ·ï¸</span> ë¼ë²¨ë§ë§Œ ì‹¤í–‰
                        </button>
                        <button class="btn btn-primary" onclick="runPipeline('augmentation')">
                            <span>ğŸ”„</span> ë°ì´í„° ì¦ê°•ë§Œ ì‹¤í–‰
                        </button>
                        <button class="btn btn-primary" onclick="runPipeline('validation')">
                            <span>âœ…</span> ê²€ì¦ë§Œ ì‹¤í–‰
                        </button>
                        <button class="btn btn-success" onclick="runPipeline('full')">
                            <span>ğŸš€</span> ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
                        </button>
                    </div>
                    
                    <div id="pipelineProgress" style="display: none;">
                        <h3 style="margin-top: 20px;">ì§„í–‰ ìƒí™©</h3>
                        <div class="progress">
                            <div class="progress-bar" id="progressBar">0%</div>
                        </div>
                        <p id="progressText" style="margin-top: 10px;"></p>
                    </div>
                </div>
                
                <!-- ì˜¤ë¥¸ìª½: íŒŒì¼ ëª©ë¡ ì„¹ì…˜ -->
                <div class="files-section">
                    <h2>ìˆ˜ì§‘ëœ íŒŒì¼</h2>
                    
                    <!-- í•„í„° ë° ì •ë ¬ ì»¨íŠ¸ë¡¤ -->
                    <div class="file-controls" style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                            <!-- í•„í„° ì˜µì…˜ -->
                            <div style="flex: 1; min-width: 200px;">
                                <label for="filterSelect" style="font-weight: bold; margin-right: 10px;">í•„í„°:</label>
                                <select id="filterSelect" name="filterSelect" onchange="applyFilter()" style="padding: 5px 10px; border-radius: 4px; border: 1px solid #ddd;">
                                    <option value="all">ì „ì²´ ë³´ê¸°</option>
                                    <option value="completed">âœ… ì™„ë£Œëœ íŒŒì¼ë§Œ</option>
                                    <option value="in_progress">ğŸ”„ ì§„í–‰ì¤‘ì¸ íŒŒì¼ë§Œ</option>
                                    <option value="not_started">âŒ ë¯¸í¸ì§‘ íŒŒì¼ë§Œ</option>
                                </select>
                            </div>
                            
                            <!-- ì •ë ¬ ì˜µì…˜ -->
                            <div style="flex: 1; min-width: 200px;">
                                <label for="sortSelect" style="font-weight: bold; margin-right: 10px;">ì •ë ¬:</label>
                                <select id="sortSelect" name="sortSelect" onchange="applySort()" style="padding: 5px 10px; border-radius: 4px; border: 1px solid #ddd;">
                                    <option value="date_desc">ìˆ˜ì •ì¼ (ìµœì‹ ìˆœ)</option>
                                    <option value="date_asc">ìˆ˜ì •ì¼ (ì˜¤ë˜ëœìˆœ)</option>
                                    <option value="name_asc">íŒŒì¼ëª… (ê°€ë‚˜ë‹¤ìˆœ)</option>
                                    <option value="name_desc">íŒŒì¼ëª… (ì—­ìˆœ)</option>
                                    <option value="status">ì™„ë£Œ ìƒíƒœìˆœ</option>
                                </select>
                            </div>
                            
                            <!-- í†µê³„ ì •ë³´ -->
                            <div style="flex: 1; min-width: 200px; text-align: right;">
                                <span id="fileStats" style="font-size: 0.9rem; color: #666;"></span>
                            </div>
                        </div>
                        
                        <!-- ê²€ìƒ‰ ë°” -->
                        <div style="margin-top: 10px;">
                            <input type="text" id="searchInput" placeholder="ğŸ” íŒŒì¼ëª… ê²€ìƒ‰..." 
                                   onkeyup="searchFiles()" 
                                   style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="refreshFiles()">
                        <span>ğŸ”„</span> ìƒˆë¡œê³ ì¹¨
                    </button>
                    <div id="loading">
                        <div class="spinner"></div>
                        <p>ë¡œë”© ì¤‘...</p>
                    </div>
                    <div class="file-list" id="fileList">
                        <p>íŒŒì¼ì„ ë¡œë“œí•˜ë ¤ë©´ ìƒˆë¡œê³ ì¹¨ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- íŒŒì¼ ì—…ë¡œë“œ íƒ­ -->
        <div id="upload" class="tab-content">
            <div class="upload-section">
                <h2>íŒŒì¼ ì—…ë¡œë“œ</h2>
                <p>PDF íŒŒì¼ì„ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>
                
                <div class="upload-area" onclick="document.getElementById('fileInput').click()" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">ğŸ“</div>
                    <h3>íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë¡­í•˜ì„¸ìš”</h3>
                    <p>ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">ì§€ì› í˜•ì‹: PDF, PNG, JPG, JPEG</p>
                </div>
                
                <label for="fileInput" style="display: block; margin-bottom: 10px;">íŒŒì¼ ì„ íƒ:</label>
                <input type="file" id="fileInput" name="fileInput" multiple accept=".pdf,.png,.jpg,.jpeg" onchange="handleFileSelect(event)">
                
                <div id="uploadedFiles" style="margin-top: 20px;"></div>
            </div>
        </div>
        
        <!-- ë¼ë²¨ë§ í¸ì§‘ íƒ­ -->
        <div id="labeling" class="tab-content">
            <div class="labeling-editor">
                <h2>ë¼ë²¨ë§ ë°ì´í„° í¸ì§‘</h2>
                
                <div id="labelingContent" style="margin-top: 20px;">
                    <p>ë¼ë²¨ë§ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                </div>
                
                <!-- ë¼ë²¨ë§ í¸ì§‘ ì¸í„°í˜ì´ìŠ¤ -->
                <div id="labelingInterface" style="display: none;">
                    <div class="labeling-main-layout">
                        <!-- ì™¼ìª½: ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ì„¹ì…˜ -->
                        <div class="labeling-controls-section">
                            <h3>ë°ì´í„° ê´€ë¦¬</h3>
                            <button class="btn btn-primary" onclick="loadLabelingData()">
                                <span>ğŸ“‚</span> ë¼ë²¨ë§ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                            </button>
                            <button class="btn btn-success" onclick="saveLabelingData()">
                                <span>ğŸ’¾</span> ë³€ê²½ì‚¬í•­ ì €ì¥
                            </button>
                            <button class="btn btn-success" onclick="saveCurrentLabelData()" id="saveCurrentBtn" style="display: none;">
                                <span>ğŸ’¾</span> í˜„ì¬ ë¼ë²¨ ì €ì¥
                            </button>
                            
                            <h3 style="margin-top: 20px;">ëª¨ë¸ ê´€ë¦¬</h3>
                            <button class="btn btn-primary" onclick="trainModel()">
                                <span>ğŸ¯</span> ëª¨ë¸ í•™ìŠµ
                            </button>
                            <button class="btn btn-info" onclick="showModelStats()">
                                <span>ğŸ“Š</span> ëª¨ë¸ í†µê³„
                            </button>
                            <button class="btn btn-success" onclick="getAutoLabels()" id="autoLabelBtn">
                                <span>ğŸ¤–</span> ìë™ ë¼ë²¨ ì œì•ˆ
                            </button>
                            
                            <h3 style="margin-top: 20px;">í¸ì§‘ ë„êµ¬</h3>
                            <button class="btn btn-primary" onclick="startDrawing()" id="drawBtn">
                                <span>âœï¸</span> Bounding Box ê·¸ë¦¬ê¸°
                            </button>
                            <button class="btn btn-warning" onclick="clearSelection()">
                                <span>ğŸ—ï¸</span> ì„ íƒ í•´ì œ
                            </button>
                            <button class="btn btn-warning" onclick="deleteSelectedBox()">
                                <span>ğŸ—‘ï¸</span> ì„ íƒí•œ Box ì‚­ì œ
                            </button>
                            <button class="btn btn-primary" onclick="addBoundingBox()">
                                <span>â•</span> ìƒˆ Bounding Box ì¶”ê°€
                            </button>
                            
                            <h3 style="margin-top: 20px;">ê·¸ë£¹ ê´€ë¦¬</h3>
                            <button class="btn btn-info" onclick="toggleGroupMode()" id="groupModeBtn">
                                <span>ğŸ”—</span> ê·¸ë£¹ ëª¨ë“œ OFF
                            </button>
                            <button class="btn btn-success" onclick="autoGroupByRows()">
                                <span>ğŸ¯</span> ìë™ í–‰ ê·¸ë£¹í•‘
                            </button>
                            <button class="btn btn-primary" onclick="highlightGroups()">
                                <span>ğŸ¨</span> ê·¸ë£¹ í•˜ì´ë¼ì´íŠ¸
                            </button>
                            
                            <!-- ê·¸ë£¹ ì„ íƒ ë° ê´€ë¦¬ UI -->
                            <div id="groupManagementPanel" style="margin-top: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; display: none;">
                                <h4>ê·¸ë£¹ ê´€ë¦¬ íŒ¨ë„</h4>
                                <div style="margin-bottom: 10px;">
                                    <label>í˜„ì¬ ê·¸ë£¹:</label>
                                    <select id="currentGroupSelect" class="form-control" onchange="selectGroup(this.value)">
                                        <option value="">ê·¸ë£¹ ì„ íƒ...</option>
                                    </select>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="createNewGroup()">
                                    <span>â•</span> ìƒˆ ê·¸ë£¹ ìƒì„±
                                </button>
                                <button class="btn btn-sm btn-success" onclick="addToCurrentGroup()" id="addToGroupBtn" disabled>
                                    <span>ğŸ“</span> ì„ íƒëœ í•­ëª©ì„ ê·¸ë£¹ì— ì¶”ê°€
                                </button>
                                <button class="btn btn-sm btn-warning" onclick="removeFromGroup()">
                                    <span>â–</span> ê·¸ë£¹ì—ì„œ ì œê±°
                                </button>
                            </div>
                        </div>
                        
                        <!-- ì¤‘ì•™: ì´ë¯¸ì§€ ì„¹ì…˜ -->
                        <div class="labeling-image-section">
                            <h3>ë¬¸ì„œ ì´ë¯¸ì§€</h3>
                            
                            <!-- PDF í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ -->
                            <div class="pdf-navigation" id="pdfNavigation">
                                <div class="page-controls">
                                    <button class="btn btn-primary" onclick="previousPage()" id="prevPageBtn">
                                        <span>â—€</span> ì´ì „ í˜ì´ì§€
                                    </button>
                                    <span class="page-info" id="pageInfo">1 / 1</span>
                                    <button class="btn btn-primary" onclick="nextPage()" id="nextPageBtn">
                                        ë‹¤ìŒ í˜ì´ì§€ <span>â–¶</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="image-preview">
                                <div class="image-container" id="imageContainer">
                                    <img id="labelingImage" src="" alt="ë¬¸ì„œ ì´ë¯¸ì§€" style="display: none;">
                                    <div id="bboxOverlays"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì˜¤ë¥¸ìª½: ë¼ë²¨ ì •ë³´ ì„¹ì…˜ -->
                        <div class="labeling-form-section">
                            <h3>ë¼ë²¨ ì •ë³´</h3>
                            <div class="form-group">
                                <label for="labelingFilename">íŒŒì¼ëª…</label>
                                <input type="text" id="labelingFilename" name="labelingFilename" readonly>
                            </div>
                            <div class="form-group">
                                <label for="documentClass">ë¬¸ì„œ í´ë˜ìŠ¤</label>
                                <select id="documentClass" name="documentClass">
                                    <option value="purchase_order">Purchase Order</option>
                                    <option value="invoice">Invoice</option>
                                    <option value="receipt">Receipt</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <h4 style="margin-top: 20px;">ë¹ ë¥¸ ë¼ë²¨ ì„ íƒ</h4>
                            <div class="label-buttons">
                                <button class="btn btn-label" onclick="setQuickLabel('Order number')">
                                    ğŸ“‹ Order number
                                </button>
                                <button class="btn btn-label" onclick="setQuickLabel('Shipping line')">
                                    ğŸš¢ Shipping line
                                </button>
                                <button class="btn btn-label" onclick="setQuickLabel('Case mark')">
                                    ğŸ“¦ Case mark
                                </button>
                                <button class="btn btn-label" onclick="setQuickLabel('Part number')">
                                    ğŸ”¢ Part number
                                </button>
                                <button class="btn btn-label" onclick="setQuickLabel('Quantity')">
                                    ğŸ“Š Quantity
                                </button>
                                <button class="btn btn-label" onclick="setQuickLabel('Fixed in USD')">
                                    ğŸ’µ Fixed in USD
                                </button>
                                <button class="btn btn-label" onclick="setQuickLabel('Unit price')">
                                    ğŸ’² Unit price
                                </button>
                                <button class="btn btn-label" onclick="setQuickLabel('Net amount (total)')">
                                    ğŸ’° Net amount (total)
                                </button>
                                <button class="btn btn-label" onclick="setQuickLabel('Production instruction receipt section')">
                                    ğŸ“„ Production instruction receipt section
                                </button>
                            </div>
                            
                            <h4 style="margin-top: 20px;">Bounding Box ëª©ë¡</h4>
                            <div id="bboxList">
                                <p>ê·¸ë ¤ì§„ Bounding Boxê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- í†µê³„ íƒ­ -->
        <div id="statistics" class="tab-content">
            <div class="stats-card">
                <h2>ë°ì´í„° í†µê³„</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalFiles">0</div>
                        <div class="stat-label">ì „ì²´ íŒŒì¼</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="processedFiles">0</div>
                        <div class="stat-label">ì²˜ë¦¬ëœ íŒŒì¼</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalLabels">0</div>
                        <div class="stat-label">ì „ì²´ ë¼ë²¨</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="augmentedData">0</div>
                        <div class="stat-label">ì¦ê°•ëœ ë°ì´í„°</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="refreshStatistics()" style="margin-top: 20px;">
                    <span>ğŸ“Š</span> í†µê³„ ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
        </div>
    </div>
    
    <script>
        let currentTaskId = null;
        let progressInterval = null;
        let uploadedFilesList = [];
        let labelingData = [];
        let allFiles = [];  // ì „ì²´ íŒŒì¼ ëª©ë¡ ì €ì¥
        let filteredFiles = [];  // í•„í„°ë§ëœ íŒŒì¼ ëª©ë¡
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ í™•ì¸
        window.onload = function() {
            console.log('Page loaded, initializing...');
            
            // ì¦‰ì‹œ ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰ ì¤‘ìœ¼ë¡œ í‘œì‹œ
            const services = [
                { id: 'collectionStatus', name: 'ë°ì´í„° ìˆ˜ì§‘' },
                { id: 'labelingStatus', name: 'ë¼ë²¨ë§' },
                { id: 'augmentationStatus', name: 'ë°ì´í„° ì¦ê°•' },
                { id: 'validationStatus', name: 'ê²€ì¦' }
            ];
            
            services.forEach(service => {
                const statusElement = document.getElementById(service.id);
                if (statusElement) {
                    statusElement.textContent = 'âœ… ì‹¤í–‰ ì¤‘';
                    statusElement.style.color = '#27ae60';
                    // parentElement ëŒ€ì‹  closest ì‚¬ìš©
                    const cardElement = statusElement.closest('.service-card');
                    if (cardElement) {
                        cardElement.className = 'service-card active';
                    }
                    console.log(`${service.name} ì„œë¹„ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
                } else {
                    console.warn(`${service.id} ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
                }
            });
            
            // íŒŒì¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => {
                refreshFiles().catch(error => {
                    console.error('File refresh failed:', error);
                });
            }, 500);
            
            // ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ (ì´ë¯¸ UIëŠ” ì—…ë°ì´íŠ¸í–ˆì§€ë§Œ, ì‹¤ì œ ìƒíƒœë„ í™•ì¸)
            checkStatus();
        };
        
        // íƒ­ ì „í™˜
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.textContent.includes(getTabTitle(tabName))) {
                    tab.classList.add('active');
                }
            });
            
            contents.forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            
            // íƒ­ë³„ ì´ˆê¸°í™”
            if (tabName === 'statistics') {
                refreshStatistics();
            }
        }
        
        function getTabTitle(tabName) {
            const titles = {
                'dashboard': 'ëŒ€ì‹œë³´ë“œ',
                'upload': 'íŒŒì¼ ì—…ë¡œë“œ',
                'labeling': 'ë¼ë²¨ë§ í¸ì§‘',
                'statistics': 'í†µê³„'
            };
            return titles[tabName] || '';
        }
        
        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                ${message}
                <span class="alert-close" onclick="this.parentElement.remove()">Ã—</span>
            `;
            
            const alertsContainer = document.getElementById('alerts');
            alertsContainer.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
        
        // ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
        async function checkStatus() {
            try {
                console.log('Checking status...');
                const response = await fetch('/api/status');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Status data received:', data);
                
                // ì„œë¹„ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                if (data.services) {
                    // ê° ì„œë¹„ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                    updateServiceStatus('collection', data.services.data_collection || {running: true, health: true});
                    updateServiceStatus('labeling', data.services.labeling || {running: true, health: true});
                    updateServiceStatus('augmentation', data.services.augmentation || {running: true, health: true});
                    updateServiceStatus('validation', data.services.validation || {running: true, health: true});
                    
                    // ëª¨ë¸ ì„œë¹„ìŠ¤ëŠ” ë³„ë„ í‘œì‹œê°€ ì—†ìœ¼ë¯€ë¡œ ë¬´ì‹œ
                } else {
                    // ì„œë¹„ìŠ¤ ì •ë³´ê°€ ì—†ìœ¼ë©´ ëª¨ë‘ ì‹¤í–‰ ì¤‘ìœ¼ë¡œ í‘œì‹œ
                    console.log('No services data, setting all to running');
                    updateServiceStatus('collection', {running: true, health: true});
                    updateServiceStatus('labeling', {running: true, health: true});
                    updateServiceStatus('augmentation', {running: true, health: true});
                    updateServiceStatus('validation', {running: true, health: true});
                }
                
            } catch (error) {
                console.error('Status check failed:', error);
                // ì˜¤ë¥˜ ì‹œì—ë„ ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰ ì¤‘ìœ¼ë¡œ í‘œì‹œ (ì„œë²„ëŠ” ì‹¤í–‰ ì¤‘ì´ë¯€ë¡œ)
                updateServiceStatus('collection', {running: true, health: true});
                updateServiceStatus('labeling', {running: true, health: true});
                updateServiceStatus('augmentation', {running: true, health: true});
                updateServiceStatus('validation', {running: true, health: true});
            }
        }
        
        function updateServiceStatus(serviceName, status) {
            console.log(`Updating ${serviceName} status:`, status);
            
            const statusElement = document.getElementById(serviceName + 'Status');
            if (!statusElement) {
                console.warn(`Status element not found for ${serviceName}`);
                return;
            }
            
            const cardElement = statusElement.parentElement;
            if (!cardElement) {
                console.warn(`Card element not found for ${serviceName}`);
                return;
            }
            
            // ìƒíƒœê°€ ìˆê³  ì‹¤í–‰ ì¤‘ì´ë©´
            if (status && (status.running || status.health)) {
                statusElement.textContent = 'âœ… ì‹¤í–‰ ì¤‘';
                statusElement.style.color = '#27ae60';
                cardElement.className = 'service-card active';
            } else if (status === undefined || status === null) {
                // ìƒíƒœ ì •ë³´ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì‹¤í–‰ ì¤‘ìœ¼ë¡œ í‘œì‹œ
                statusElement.textContent = 'âœ… ì‹¤í–‰ ì¤‘';
                statusElement.style.color = '#27ae60';
                cardElement.className = 'service-card active';
            } else {
                statusElement.textContent = 'âŒ ì¤‘ì§€ë¨';
                statusElement.style.color = '#e74c3c';
                cardElement.className = 'service-card inactive';
            }
        }
        
        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }
        
        function handleDragLeave(e) {
            e.currentTarget.classList.remove('dragover');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            uploadFiles(files);
        }
        
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            uploadFiles(files);
        }
        
        async function uploadFiles(files) {
            const validFiles = files.filter(file => {
                const ext = file.name.toLowerCase().split('.').pop();
                return ['pdf', 'png', 'jpg', 'jpeg'].includes(ext);
            });
            
            if (validFiles.length === 0) {
                showAlert('ìœ íš¨í•œ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. PDF, PNG, JPG íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            for (const file of validFiles) {
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    const response = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        showAlert(`${file.name} ì—…ë¡œë“œ ì„±ê³µ`, 'success');
                        uploadedFilesList.push(result);
                        updateUploadedFilesList();
                    } else {
                        showAlert(`${file.name} ì—…ë¡œë“œ ì‹¤íŒ¨`, 'error');
                    }
                } catch (error) {
                    showAlert(`${file.name} ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ`, 'error');
                }
            }
        }
        
        function updateUploadedFilesList() {
            const container = document.getElementById('uploadedFiles');
            container.innerHTML = '<h3>ì—…ë¡œë“œëœ íŒŒì¼</h3>';
            
            uploadedFilesList.forEach(file => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'file-item';
                fileDiv.innerHTML = `
                    <div class="file-info">
                        <strong>${file.name}</strong><br>
                        <small>í¬ê¸°: ${formatFileSize(file.size)}</small>
                    </div>
                    <div class="file-actions">
                        <button class="btn btn-small btn-primary" onclick="processFile('${file.id}')">ì²˜ë¦¬</button>
                        <button class="btn btn-small btn-warning" onclick="removeFile('${file.id}')">ì‚­ì œ</button>
                    </div>
                `;
                container.appendChild(fileDiv);
            });
        }
        
        // íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
        async function runPipeline(mode) {
            try {
                // ë²„íŠ¼ ë¹„í™œì„±í™”
                const buttons = document.querySelectorAll('.btn');
                buttons.forEach(btn => btn.disabled = true);
                
                // ì§„í–‰ ìƒí™© í‘œì‹œ
                document.getElementById('pipelineProgress').style.display = 'block';
                updateProgress(0, `${mode} íŒŒì´í”„ë¼ì¸ ì‹œì‘ ì¤‘...`);
                
                const response = await fetch(`/api/pipeline/${mode}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                currentTaskId = data.task_id;
                
                showAlert(`${mode} íŒŒì´í”„ë¼ì¸ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
                
                // ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§ ì‹œì‘
                progressInterval = setInterval(checkTaskProgress, 1000);
                
            } catch (error) {
                showAlert(`íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ì‹¤íŒ¨: ${error}`, 'error');
                resetUI();
            }
        }
        
        async function checkTaskProgress() {
            if (!currentTaskId) return;
            
            try {
                const response = await fetch(`/api/task/${currentTaskId}`);
                const data = await response.json();
                
                if (data.status === 'completed') {
                    updateProgress(100, 'ì™„ë£Œ!');
                    showAlert('íŒŒì´í”„ë¼ì¸ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    clearInterval(progressInterval);
                    resetUI();
                    refreshFiles();
                } else if (data.status === 'failed') {
                    showAlert(`íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ì‹¤íŒ¨: ${data.error}`, 'error');
                    clearInterval(progressInterval);
                    resetUI();
                } else {
                    // ì‹¤í–‰ ì¤‘ - ì‹¤ì œ ì§„í–‰ë¥  í‘œì‹œ
                    const progress = data.progress || 0;
                    const operation = data.current_operation || 'ì²˜ë¦¬ ì¤‘...';
                    updateProgress(Math.round(progress), operation);
                }
                
            } catch (error) {
                console.error('Progress check failed:', error);
            }
        }
        
        function updateProgress(percent, text) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressBar').textContent = percent + '%';
            document.getElementById('progressText').textContent = text;
        }
        
        function resetUI() {
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => btn.disabled = false);
            currentTaskId = null;
            
            setTimeout(() => {
                document.getElementById('pipelineProgress').style.display = 'none';
            }, 3000);
        }
        
        // íŒŒì¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        async function refreshFiles() {
            document.getElementById('loading').style.display = 'block';
            
            try {
                const response = await fetch('/api/files');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const files = await response.json();
                console.log('Files received:', files);
                
                // ì „ì²´ íŒŒì¼ ëª©ë¡ ì €ì¥
                allFiles = files;
                
                // ê° íŒŒì¼ì— ìƒíƒœ ì •ë³´ ì¶”ê°€
                allFiles.forEach(file => {
                    if (file.is_complete) {
                        file.status = 'completed';
                    } else if (file.label_count > 0 && file.label_count < file.split_count) {
                        file.status = 'in_progress';
                    } else {
                        file.status = 'not_started';
                    }
                });
                
                // ì´ˆê¸° í•„í„° ë° ì •ë ¬ ì ìš©
                applyFilter();
                updateFileStats();
                
            } catch (error) {
                console.error('Error loading files:', error);
                showAlert(`íŒŒì¼ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ${error}`, 'error');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        // íŒŒì¼ ëª©ë¡ í‘œì‹œ
        function displayFiles(files) {
            const fileListDiv = document.getElementById('fileList');
            fileListDiv.innerHTML = '';
            
            if (files.length === 0) {
                fileListDiv.innerHTML = '<p>í•´ë‹¹í•˜ëŠ” íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                files.forEach((file, index) => {
                        const fileDiv = document.createElement('div');
                        // ìƒíƒœë³„ í´ë˜ìŠ¤ ì¶”ê°€
                        let statusClass = 'file-item';
                        if (file.status === 'completed') {
                            statusClass = 'file-item complete';
                        } else if (file.status === 'in_progress') {
                            statusClass = 'file-item in-progress';
                        } else {
                            statusClass = 'file-item not-started';
                        }
                        fileDiv.className = statusClass;
                        
                        // ì™„ë£Œ ìƒíƒœ ë±ƒì§€ ìƒì„±
                        let statusBadge = '';
                        if (file.status === 'completed') {
                            statusBadge = '<span class="status-badge complete">âœ… ì™„ë£Œ</span>';
                        } else if (file.status === 'in_progress') {
                            statusBadge = '<span class="status-badge in-progress">ğŸ”„ ì§„í–‰ì¤‘</span>';
                        } else {
                            statusBadge = '<span class="status-badge not-started">âŒ ë¯¸í¸ì§‘</span>';
                        }
                        
                        // íŒŒì¼ ì •ë³´ ì˜ì—­
                        const fileInfoDiv = document.createElement('div');
                        fileInfoDiv.className = 'file-info';
                        fileInfoDiv.innerHTML = `
                            <strong>${file.name}</strong> ${statusBadge}<br>
                            <small>í¬ê¸°: ${formatFileSize(file.size)} | ìˆ˜ì •ì¼: ${new Date(file.modified).toLocaleString()}</small>
                            <div class="file-status">
                                <span class="status-badge split">ğŸ“„ ë¶„í• POìˆ˜: ${file.split_count || 0}</span>
                                <span class="status-badge label">ğŸ·ï¸ ë¼ë²¨ ìˆ˜: ${file.label_count || 0}</span>
                            </div>
                        `;
                        
                        // íŒŒì¼ ì•¡ì…˜ ë²„íŠ¼ë“¤
                        const fileActionsDiv = document.createElement('div');
                        fileActionsDiv.className = 'file-actions';
                        
                        // ë³´ê¸° ë²„íŠ¼
                        const viewBtn = document.createElement('button');
                        viewBtn.className = 'btn btn-small btn-primary';
                        viewBtn.textContent = 'ë³´ê¸°';
                        viewBtn.onclick = () => viewFile(file.name);
                        
                        // ë¼ë²¨ í¸ì§‘ ë²„íŠ¼
                        const editBtn = document.createElement('button');
                        editBtn.className = 'btn btn-small btn-warning';
                        editBtn.textContent = 'ë¼ë²¨ í¸ì§‘';
                        editBtn.onclick = () => editLabels(file.name);
                        
                        // ì‚­ì œ ë²„íŠ¼
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'btn btn-small btn-danger';
                        deleteBtn.textContent = 'ì‚­ì œ';
                        deleteBtn.onclick = () => deleteCollectedFile(file.path, file.name);
                        
                        fileActionsDiv.appendChild(viewBtn);
                        fileActionsDiv.appendChild(editBtn);
                        fileActionsDiv.appendChild(deleteBtn);
                        
                        fileDiv.appendChild(fileInfoDiv);
                        fileDiv.appendChild(fileActionsDiv);
                        fileListDiv.appendChild(fileDiv);
                    });
                }
            }
        
        // í•„í„° ì ìš©
        function applyFilter() {
            const filterSelect = document.getElementById('filterSelect');
            const filterValue = filterSelect ? filterSelect.value : 'all';
            
            console.log('Applying filter:', filterValue);
            console.log('All files:', allFiles);
            
            if (!allFiles) {
                console.error('No files loaded yet');
                return;
            }
            
            if (filterValue === 'all') {
                filteredFiles = [...allFiles];
            } else if (filterValue === 'completed') {
                filteredFiles = allFiles.filter(f => f.status === 'completed');
            } else if (filterValue === 'in_progress') {
                filteredFiles = allFiles.filter(f => f.status === 'in_progress');
            } else if (filterValue === 'not_started') {
                filteredFiles = allFiles.filter(f => f.status === 'not_started');
            }
            
            console.log('Filtered files:', filteredFiles);
            
            // ì •ë ¬ ì ìš©
            applySort();
        }
        
        // ì •ë ¬ ì ìš©
        function applySort() {
            const sortValue = document.getElementById('sortSelect').value;
            
            switch(sortValue) {
                case 'date_desc':
                    filteredFiles.sort((a, b) => new Date(b.modified) - new Date(a.modified));
                    break;
                case 'date_asc':
                    filteredFiles.sort((a, b) => new Date(a.modified) - new Date(b.modified));
                    break;
                case 'name_asc':
                    filteredFiles.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'name_desc':
                    filteredFiles.sort((a, b) => b.name.localeCompare(a.name));
                    break;
                case 'status':
                    // ì™„ë£Œ > ì§„í–‰ì¤‘ > ë¯¸ì‹œì‘ ìˆœìœ¼ë¡œ ì •ë ¬
                    const statusOrder = {'completed': 0, 'in_progress': 1, 'not_started': 2};
                    filteredFiles.sort((a, b) => statusOrder[a.status] - statusOrder[b.status]);
                    break;
            }
            
            // ê²€ìƒ‰ í•„í„° ì ìš©
            searchFiles();
        }
        
        // íŒŒì¼ëª… ê²€ìƒ‰
        function searchFiles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let searchedFiles = filteredFiles;
            if (searchTerm) {
                searchedFiles = filteredFiles.filter(f => 
                    f.name.toLowerCase().includes(searchTerm)
                );
            }
            
            displayFiles(searchedFiles);
        }
        
        // íŒŒì¼ í†µê³„ ì—…ë°ì´íŠ¸
        function updateFileStats() {
            const total = allFiles.length;
            const completed = allFiles.filter(f => f.status === 'completed').length;
            const inProgress = allFiles.filter(f => f.status === 'in_progress').length;
            const notStarted = allFiles.filter(f => f.status === 'not_started').length;
            
            const statsText = `ì „ì²´: ${total}ê°œ | âœ… ì™„ë£Œ: ${completed}ê°œ | ğŸ”„ ì§„í–‰ì¤‘: ${inProgress}ê°œ | âŒ ë¯¸í¸ì§‘: ${notStarted}ê°œ`;
            document.getElementById('fileStats').textContent = statsText;
        }
        
        // ë¼ë²¨ë§ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadLabelingData() {
            try {
                const response = await fetch('/api/labels');
                const data = await response.json();
                
                labelingData = data;
                displayLabelingData();
                showAlert('ë¼ë²¨ë§ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');
                
            } catch (error) {
                showAlert(`ë¼ë²¨ë§ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error}`, 'error');
            }
        }
        
        function displayLabelingData() {
            const content = document.getElementById('labelingContent');
            content.innerHTML = '';
            
            if (labelingData.length === 0) {
                content.innerHTML = '<p>ë¼ë²¨ë§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            labelingData.forEach((item, index) => {
                const labelDiv = document.createElement('div');
                labelDiv.className = 'label-form';
                labelDiv.innerHTML = `
                    <h3>ë¼ë²¨ ${index + 1}</h3>
                    <div class="form-group">
                        <label>íŒŒì¼ëª…</label>
                        <input type="text" value="${item.filename}" readonly>
                    </div>
                    <div class="form-group">
                        <label>í´ë˜ìŠ¤</label>
                        <select id="class_${index}">
                            <option value="purchase_order" ${item.class === 'purchase_order' ? 'selected' : ''}>Purchase Order</option>
                            <option value="invoice" ${item.class === 'invoice' ? 'selected' : ''}>Invoice</option>
                            <option value="receipt" ${item.class === 'receipt' ? 'selected' : ''}>Receipt</option>
                            <option value="other" ${item.class === 'other' ? 'selected' : ''}>Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>í…ìŠ¤íŠ¸</label>
                        <textarea id="text_${index}">${item.text || ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Bounding Box (x, y, width, height)</label>
                        <input type="text" id="bbox_${index}" value="${item.bbox ? item.bbox.join(', ') : ''}">
                    </div>
                `;
                content.appendChild(labelDiv);
            });
        }
        
        // ë¼ë²¨ë§ ë°ì´í„° ì €ì¥ (ë³€ê²½ì‚¬í•­ ì €ì¥ ë²„íŠ¼)
        async function saveLabelingData() {
            // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ë¼ë²¨ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì €ì¥
            if (currentLabelData && bboxData.length > 0) {
                await saveCurrentLabelData();
                return;
            }
            
            // ì „ì²´ ë¼ë²¨ë§ ë°ì´í„° ëª©ë¡ì´ ìˆëŠ” ê²½ìš° (ê¸°ì¡´ ë¡œì§)
            if (labelingData && labelingData.length > 0) {
                try {
                    // ìˆ˜ì •ëœ ë°ì´í„° ìˆ˜ì§‘
                    const updatedData = labelingData.map((item, index) => {
                        // DOM ìš”ì†Œê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
                        const classElem = document.getElementById(`class_${index}`);
                        const textElem = document.getElementById(`text_${index}`);
                        const bboxElem = document.getElementById(`bbox_${index}`);
                        
                        if (classElem && textElem && bboxElem) {
                            return {
                                ...item,
                                class: classElem.value,
                                text: textElem.value,
                                bbox: bboxElem.value.split(',').map(v => parseInt(v.trim()))
                            };
                        }
                        return item;
                    });
                    
                    const response = await fetch('/api/labels', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updatedData)
                    });
                    
                    if (response.ok) {
                        showAlert('ë¼ë²¨ë§ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    } else {
                        showAlert('ì €ì¥ ì‹¤íŒ¨', 'error');
                    }
                    
                } catch (error) {
                    showAlert(`ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error}`, 'error');
                }
            } else {
                showAlert('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
            }
        }
        
        // í†µê³„ ìƒˆë¡œê³ ì¹¨
        async function refreshStatistics() {
            try {
                const response = await fetch('/api/statistics');
                const stats = await response.json();
                
                document.getElementById('totalFiles').textContent = stats.total_files || 0;
                document.getElementById('processedFiles').textContent = stats.processed_files || 0;
                document.getElementById('totalLabels').textContent = stats.total_labels || 0;
                document.getElementById('augmentedData').textContent = stats.augmented_data || 0;
                
                showAlert('í†µê³„ë¥¼ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.', 'info');
                
            } catch (error) {
                showAlert(`í†µê³„ ë¡œë“œ ì‹¤íŒ¨: ${error}`, 'error');
            }
        }
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜ë“¤
        async function processFile(fileId) {
            try {
                const response = await fetch(`/api/process/${fileId}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showAlert('íŒŒì¼ OCR ì²˜ë¦¬ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                    
                    // ì§„í–‰ ìƒí™© í™•ì¸
                    setTimeout(() => checkTaskProgress(), 1000);
                } else {
                    showAlert('íŒŒì¼ ì²˜ë¦¬ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                showAlert(`íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ${error}`, 'error');
            }
        }
        
        async function removeFile(fileId) {
            if (!confirm('ì •ë§ë¡œ ì´ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/delete/${fileId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showAlert('íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    
                    // ì—…ë¡œë“œ ëª©ë¡ì—ì„œ ì œê±°
                    uploadedFilesList = uploadedFilesList.filter(f => f.id !== parseInt(fileId));
                    updateUploadedFilesList();
                } else {
                    showAlert('íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                showAlert(`íŒŒì¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜: ${error}`, 'error');
            }
        }
        
        function viewFile(filename) {
            // íŒŒì¼ ë³´ê¸° ê¸°ëŠ¥ êµ¬í˜„
            window.open(`/api/view/${encodeURIComponent(filename)}`, '_blank');
        }
        
        function editLabels(filename) {
            // ë¼ë²¨ í¸ì§‘ íƒ­ìœ¼ë¡œ ì´ë™
            showTab('labeling');
            // íŠ¹ì • íŒŒì¼ì˜ ë¼ë²¨ ë°ì´í„° ë¡œë“œ
            loadLabelingDataForFile(filename);
        }
        
        async function loadLabelingDataForFile(filename) {
            try {
                // í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ 1ë¡œ ì´ˆê¸°í™”
                currentPdfPage = 1;
                totalPdfPages = 1;  // ì´ˆê¸°í™”
                
                console.log(`Loading labeling data for file: ${filename}`);
                
                // ì „ì²´ íŒŒì¼ëª… ì €ì¥
                currentFullFilename = filename;
                
                // íƒ€ì„ìŠ¤íƒ¬í”„ê°€ í¬í•¨ëœ íŒŒì¼ëª…ì—ì„œ ì›ë³¸ PDF íŒŒì¼ëª… ì¶”ì¶œ
                let originalPdfName = filename;
                const timestampMatch = filename.match(/^\d{8}_\d{6}_(.+?)(?:\.pdf)?$/i);
                if (timestampMatch) {
                    originalPdfName = timestampMatch[1];
                    // .pdf í™•ì¥ìê°€ ì—†ìœ¼ë©´ ì¶”ê°€
                    if (!originalPdfName.toLowerCase().endsWith('.pdf')) {
                        originalPdfName += '.pdf';
                    }
                    console.log(`Extracted original PDF name: ${originalPdfName}`);
                }
                
                const response = await fetch(`/api/labels/${encodeURIComponent(filename)}?page=${currentPdfPage}`);
                const data = await response.json();
                
                // ë¼ë²¨ë§ ì¸í„°í˜ì´ìŠ¤ í‘œì‹œ
                document.getElementById('labelingContent').style.display = 'none';
                document.getElementById('labelingInterface').style.display = 'block';
                document.getElementById('saveCurrentBtn').style.display = 'inline-flex';
                
                // íŒŒì¼ ì •ë³´ ì„¤ì •
                document.getElementById('labelingFilename').value = data.filename || filename;
                document.getElementById('documentClass').value = data.class || 'purchase_order';
                
                // PDF íŒŒì¼ì¸ì§€ í™•ì¸í•˜ê³  í˜ì´ì§€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                // ì›ë³¸ PDF íŒŒì¼ëª… ì‚¬ìš©
                if (originalPdfName && originalPdfName.toLowerCase().endsWith('.pdf')) {
                    currentPdfFile = originalPdfName;
                    console.log(`This is a PDF file: ${originalPdfName}`);
                    
                    // PNG íŒŒì¼ í”„ë¦¬í”½ìŠ¤ ì„¤ì • (íƒ€ì„ìŠ¤íƒ¬í”„ê°€ ìˆìœ¼ë©´ ì „ì²´ íŒŒì¼ëª…, ì—†ìœ¼ë©´ ì›ë³¸ íŒŒì¼ëª…)
                    if (timestampMatch) {
                        // íƒ€ì„ìŠ¤íƒ¬í”„ê°€ í¬í•¨ëœ ì „ì²´ íŒŒì¼ëª…ì—ì„œ í™•ì¥ì ì œê±°
                        currentPngPrefix = filename.replace('.pdf', '');
                        console.log(`PNG prefix set from full filename: ${currentPngPrefix}`);
                    } else if (data.image_path) {
                        // image_pathì—ì„œ í”„ë¦¬í”½ìŠ¤ ì¶”ì¶œ
                        const match = data.image_path.match(/\/(\d{8}_\d{6}_[^/]+)_page_/);
                        if (match) {
                            currentPngPrefix = match[1];
                            console.log(`PNG prefix extracted from image_path: ${currentPngPrefix}`);
                        }
                    }
                    
                    // PDF ì •ë³´ ë¡œë“œ (PNG í”„ë¦¬í”½ìŠ¤ ì„¤ì • í›„)
                    await loadPdfInfo(originalPdfName);
                    document.getElementById('pdfNavigation').classList.add('visible');
                    
                    // í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ ì„¤ì • (ë°ì´í„°ì— ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ 1)
                    if (data.current_page) {
                        currentPdfPage = data.current_page;
                    }
                    // í˜ì´ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
                    updatePageInfo();
                } else {
                    console.log(`Not a PDF file: ${filename}`);
                    document.getElementById('pdfNavigation').classList.remove('visible');
                    currentPdfFile = null;
                    currentPngPrefix = null;
                }
                
                // ì´ë¯¸ì§€ í‘œì‹œ
                if (data.image_path) {
                    const img = document.getElementById('labelingImage');
                    img.style.display = 'block';
                    
                    // ì„±ê³µ í•¸ë“¤ëŸ¬
                    img.onload = function() {
                        console.log('Image loaded successfully');
                        console.log(`Image dimensions: ${img.naturalWidth}x${img.naturalHeight}`);
                        
                        // ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ í¬ê¸° ì¡°ì •
                        const container = document.getElementById('imageContainer');
                        container.style.width = img.naturalWidth + 'px';
                        container.style.height = img.naturalHeight + 'px';
                        
                        // ì´ë¯¸ì§€ ë¡œë“œ í›„ bbox í‘œì‹œ
                        if (data.ocr_results && Array.isArray(data.ocr_results)) {
                            displayOCRResults(data.ocr_results);
                        } else if (data.bboxes && Array.isArray(data.bboxes) && data.bboxes.length > 0) {
                            // ê¸°ì¡´ bbox ë°ì´í„°ê°€ ìˆìœ¼ë©´ í‘œì‹œ
                            displayExistingBboxes(data.bboxes);
                        } else if (data.bbox && Array.isArray(data.bbox) && data.bbox.length > 0) {
                            // ì´ì „ í˜•ì‹ì˜ bbox ë°ì´í„°ê°€ ìˆìœ¼ë©´ í‘œì‹œ
                            displayExistingBbox(data.bbox);
                        }
                    };
                    
                    // ì‹¤íŒ¨ í•¸ë“¤ëŸ¬
                    img.onerror = function() {
                        console.error('Image load error:', data.image_path);
                        
                        // PDF íŒŒì¼ì¸ ê²½ìš° ëŒ€ì²´ ê²½ë¡œ ì‹œë„
                        if (data.filename && data.filename.toLowerCase().endsWith('.pdf')) {
                            console.log('Trying alternative PDF path...');
                            // processed/images ë””ë ‰í† ë¦¬ì—ì„œ ì§ì ‘ ì°¾ê¸°
                            const processedImagePath = `/api/view/${encodeURIComponent(data.filename.replace('.pdf', `_page_${String(currentPdfPage).padStart(3, '0')}.png`))}`;
                            console.log(`Alternative path: ${processedImagePath}`);
                            img.src = processedImagePath;
                        } else {
                            showAlert(`ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${data.image_path}`, 'error');
                        }
                    };
                    
                    // ì´ë¯¸ì§€ ì†ŒìŠ¤ ì„¤ì •
                    img.src = data.image_path;
                    console.log('Setting image source:', data.image_path);
                }
                
                // í˜„ì¬ ë¼ë²¨ ë°ì´í„° ì €ì¥
                currentLabelData = data;
                
            } catch (error) {
                showAlert(`íŒŒì¼ ë¼ë²¨ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error}`, 'error');
            }
        }
        
        // Bounding Box ê·¸ë¦¬ê¸° ê´€ë ¨ í•¨ìˆ˜ë“¤
        let isDrawing = false;
        let startX, startY;
        let currentBox = null;
        let selectedBoxId = null;
        let bboxData = [];
        let currentLabelData = null;
        let currentPdfPage = 1;
        let totalPdfPages = 1;
        let currentPdfFile = null;
        let currentPngPrefix = null;  // PNG íŒŒì¼ í”„ë¦¬í”½ìŠ¤ (íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨)
        let currentFullFilename = null;  // íƒ€ì„ìŠ¤íƒ¬í”„ê°€ í¬í•¨ëœ ì „ì²´ íŒŒì¼ëª…
        let currentGroupId = null;  // í˜„ì¬ ì„ íƒëœ ê·¸ë£¹ ID
        let groupMode = false;  // ê·¸ë£¹ ëª¨ë“œ í™œì„±í™” ì—¬ë¶€
        
        function startDrawing() {
            isDrawing = true;
            document.getElementById('drawBtn').textContent = 'ğŸ”´ ê·¸ë¦¬ê¸° ì¤‘...';
            document.getElementById('imageContainer').style.cursor = 'crosshair';
            
            const container = document.getElementById('imageContainer');
            container.onmousedown = handleMouseDown;
            container.onmousemove = handleMouseMove;
            container.onmouseup = handleMouseUp;
        }
        
        function stopDrawing() {
            isDrawing = false;
            document.getElementById('drawBtn').innerHTML = '<span>âœï¸</span> Bounding Box ê·¸ë¦¬ê¸°';
            document.getElementById('imageContainer').style.cursor = 'default';
            
            const container = document.getElementById('imageContainer');
            container.onmousedown = null;
            container.onmousemove = null;
            container.onmouseup = null;
        }
        
        function handleMouseDown(e) {
            if (!isDrawing) return;
            
            const rect = e.target.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
            
            // ìƒˆ bbox ìƒì„±
            currentBox = document.createElement('div');
            currentBox.className = 'bbox-overlay';
            currentBox.style.left = startX + 'px';
            currentBox.style.top = startY + 'px';
            currentBox.style.width = '0px';
            currentBox.style.height = '0px';
            
            document.getElementById('bboxOverlays').appendChild(currentBox);
        }
        
        function handleMouseMove(e) {
            if (!isDrawing || !currentBox) return;
            
            const rect = e.target.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            const width = Math.abs(currentX - startX);
            const height = Math.abs(currentY - startY);
            
            currentBox.style.width = width + 'px';
            currentBox.style.height = height + 'px';
            currentBox.style.left = Math.min(currentX, startX) + 'px';
            currentBox.style.top = Math.min(currentY, startY) + 'px';
        }
        
        function handleMouseUp(e) {
            if (!isDrawing || !currentBox) return;
            
            const rect = e.target.getBoundingClientRect();
            const endX = e.clientX - rect.left;
            const endY = e.clientY - rect.top;
            
            const bbox = {
                id: Date.now(),
                x: Math.min(startX, endX),
                y: Math.min(startY, endY),
                width: Math.abs(endX - startX),
                height: Math.abs(endY - startY),
                text: '',
                label: ''
            };
            
            if (bbox.width > 10 && bbox.height > 10) {
                bboxData.push(bbox);
                currentBox.id = 'bbox-' + bbox.id;
                
                // resize handles ì¶”ê°€
                addResizeHandles(currentBox);
                makeDraggable(currentBox, bbox);
                
                currentBox.onclick = (e) => {
                    if (!e.target.classList.contains('resize-handle')) {
                        selectBoundingBox(bbox.id);
                    }
                };
                
                // ë¼ë²¨ ì¶”ê°€
                const label = document.createElement('div');
                label.className = 'bbox-label';
                label.textContent = `Box ${bboxData.length}`;
                currentBox.appendChild(label);
                
                updateBoundingBoxList();
            } else {
                // ë„ˆë¬´ ì‘ì€ ë°•ìŠ¤ëŠ” ì œê±°
                currentBox.remove();
            }
            
            currentBox = null;
            stopDrawing();
        }
        
        function selectBoundingBox(id) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.bbox-overlay').forEach(box => {
                box.classList.remove('selected');
            });
            document.querySelectorAll('.bbox-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // ìƒˆ ì„ íƒ
            selectedBoxId = id;
            document.getElementById('bbox-' + id).classList.add('selected');
            document.getElementById('bbox-item-' + id).classList.add('selected');
            
            // ê·¸ë£¹ ëª¨ë“œì—ì„œ ìë™ìœ¼ë¡œ ê·¸ë£¹ì— ì¶”ê°€
            if (groupMode && currentGroupId) {
                const bbox = bboxData.find(b => b.id === id);
                if (bbox && !bbox.group_id) {
                    bbox.group_id = currentGroupId;
                    
                    // ì‹œê°ì  ì—…ë°ì´íŠ¸
                    const element = document.getElementById(`bbox-${bbox.id}`);
                    if (element) {
                        element.style.border = '3px solid #ff9800';
                        element.style.backgroundColor = 'rgba(255, 152, 0, 0.2)';
                    }
                    
                    updateBboxList();
                    showAlert(`í•­ëª©ì´ ê·¸ë£¹ '${currentGroupId}'ì— ìë™ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
                }
            }
        }
        
        function updateBoundingBoxList() {
            const listContainer = document.getElementById('bboxList');
            listContainer.innerHTML = '';
            
            console.log('updateBoundingBoxList - bboxData:', bboxData);
            
            bboxData.forEach((bbox, index) => {
                console.log(`Rendering bbox ${index}:`, bbox);
                const item = document.createElement('div');
                item.className = 'bbox-item';
                item.id = 'bbox-item-' + bbox.id;
                item.onclick = () => selectBoundingBox(bbox.id);
                
                const groupBadge = bbox.group_id ? 
                    `<span class="badge badge-info" style="margin-left: 10px;">${bbox.group_id}</span>` : '';
                
                item.innerHTML = `
                    <h5>Bounding Box ${index + 1}${groupBadge}</h5>
                    <div class="form-group">
                        <label>ìœ„ì¹˜ (x, y, width, height)</label>
                        <input type="text" value="${bbox.x}, ${bbox.y}, ${bbox.width}, ${bbox.height}" readonly>
                    </div>
                    <div class="form-group">
                        <label>ë¼ë²¨</label>
                        <input type="text" id="bbox-label-${bbox.id}" value="${bbox.label}" 
                               onchange="updateBboxData(${bbox.id}, 'label', this.value)"
                               placeholder="ì˜ˆ: êµ¬ë§¤ ë²ˆí˜¸, ê³µê¸‰ì—…ì²´ëª… ë“±">
                    </div>
                    <div class="form-group">
                        <label>ì¶”ì¶œëœ í…ìŠ¤íŠ¸</label>
                        <textarea id="bbox-text-${bbox.id}" 
                                  onchange="updateBboxData(${bbox.id}, 'text', this.value)"
                                  placeholder="OCRë¡œ ì¶”ì¶œëœ í…ìŠ¤íŠ¸">${bbox.text}</textarea>
                    </div>
                    <div class="form-group">
                        <label>ê·¸ë£¹</label>
                        <input type="text" id="bbox-group-${bbox.id}" value="${bbox.group_id || ''}" 
                               onchange="updateBboxData(${bbox.id}, 'group_id', this.value)"
                               placeholder="ê·¸ë£¹ ID (ì˜ˆ: item_00001)">
                    </div>
                `;
                
                listContainer.appendChild(item);
            });
        }
        
        function updateBboxData(id, field, value) {
            const bbox = bboxData.find(b => b.id === id);
            if (bbox) {
                bbox[field] = value;
            }
        }
        
        function deleteSelectedBox() {
            if (!selectedBoxId) {
                showAlert('ì‚­ì œí•  Bounding Boxë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            // DOMì—ì„œ ì œê±°
            document.getElementById('bbox-' + selectedBoxId).remove();
            
            // ë°ì´í„°ì—ì„œ ì œê±°
            bboxData = bboxData.filter(b => b.id !== selectedBoxId);
            
            // ëª©ë¡ ì—…ë°ì´íŠ¸
            updateBoundingBoxList();
            selectedBoxId = null;
        }
        
        function clearSelection() {
            selectedBoxId = null;
            document.querySelectorAll('.bbox-overlay').forEach(box => {
                box.classList.remove('selected');
            });
            document.querySelectorAll('.bbox-item').forEach(item => {
                item.classList.remove('selected');
            });
        }
        
        function addBoundingBox() {
            // ìˆ˜ë™ìœ¼ë¡œ bbox ì¶”ê°€
            const bbox = {
                id: Date.now(),
                x: 50,
                y: 50,
                width: 200,
                height: 50,
                text: '',
                label: ''
            };
            
            bboxData.push(bbox);
            createBboxElement(bbox);
            updateBoundingBoxList();
            selectBoundingBox(bbox.id);
        }
        
        function displayOCRResults(ocrResults) {
            if (!Array.isArray(ocrResults)) return;
            
            // ê¸°ì¡´ bbox ì´ˆê¸°í™”
            bboxData = [];
            document.getElementById('bboxOverlays').innerHTML = '';
            
            // OCR ê²°ê³¼ë¥¼ bboxë¡œ ë³€í™˜
            ocrResults.forEach((result, index) => {
                if (result.words && Array.isArray(result.words)) {
                    result.words.forEach((word, wordIndex) => {
                        if (word.bbox) {
                            const bbox = {
                                id: Date.now() + wordIndex,
                                x: word.bbox.x || 0,
                                y: word.bbox.y || 0,
                                width: word.bbox.width || 100,
                                height: word.bbox.height || 30,
                                text: word.text || '',
                                label: '',
                                confidence: word.confidence || 0
                            };
                            
                            bboxData.push(bbox);
                            createBboxElement(bbox);
                        }
                    });
                }
            });
            
            updateBoundingBoxList();
        }
        
        function displayExistingBbox(bboxArray) {
            // ê¸°ì¡´ bbox ë°ì´í„° í‘œì‹œ (ì´ì „ í˜•ì‹)
            bboxData = [];
            document.getElementById('bboxOverlays').innerHTML = '';
            
            bboxArray.forEach((coords, index) => {
                if (coords && coords.length >= 4) {
                    const bbox = {
                        id: Date.now() + index,
                        x: coords[0],
                        y: coords[1],
                        width: coords[2],
                        height: coords[3],
                        text: '',
                        label: ''
                    };
                    
                    bboxData.push(bbox);
                    createBboxElement(bbox);
                }
            });
            
            updateBoundingBoxList();
        }
        
        function displayExistingBboxes(bboxesArray) {
            // ê¸°ì¡´ bbox ë°ì´í„° í‘œì‹œ (ìƒˆ í˜•ì‹)
            bboxData = [];
            document.getElementById('bboxOverlays').innerHTML = '';
            
            console.log('displayExistingBboxes called with:', bboxesArray);
            
            bboxesArray.forEach((bboxInfo, index) => {
                console.log(`Processing bbox ${index}:`, bboxInfo);
                const bbox = {
                    id: Date.now() + index,
                    x: bboxInfo.x || 0,
                    y: bboxInfo.y || 0,
                    width: bboxInfo.width || 100,
                    height: bboxInfo.height || 30,
                    text: bboxInfo.text || '',
                    label: bboxInfo.label || '',
                    group_id: bboxInfo.group_id || ''  // group_id í•„ë“œ ì¶”ê°€
                };
                console.log(`Created bbox object:`, bbox);
                
                bboxData.push(bbox);
                createBboxElement(bbox);
            });
            
            updateBoundingBoxList();
            updateBboxList();  // ê·¸ë£¹ë³„ ëª©ë¡ë„ ì—…ë°ì´íŠ¸
            
            // ê·¸ë£¹ ëª¨ë“œê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ê·¸ë£¹ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            if (groupMode) {
                updateGroupSelect();
            }
        }
        
        function createBboxElement(bbox) {
            const boxDiv = document.createElement('div');
            boxDiv.className = 'bbox-overlay';
            boxDiv.id = 'bbox-' + bbox.id;
            boxDiv.style.left = bbox.x + 'px';
            boxDiv.style.top = bbox.y + 'px';
            boxDiv.style.width = bbox.width + 'px';
            boxDiv.style.height = bbox.height + 'px';
            
            // group_idê°€ ìˆê³  "-"ê°€ ì•„ë‹Œ ê²½ìš° ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ ì ìš©
            if (bbox.group_id && bbox.group_id !== '-') {
                boxDiv.style.borderColor = '#ff9800';
                boxDiv.style.backgroundColor = 'rgba(255, 152, 0, 0.1)';
            }
            
            // resize handles ì¶”ê°€
            addResizeHandles(boxDiv);
            makeDraggable(boxDiv, bbox);
            
            boxDiv.onclick = (e) => {
                if (!e.target.classList.contains('resize-handle')) {
                    selectBoundingBox(bbox.id);
                }
            };
            
            const label = document.createElement('div');
            label.className = 'bbox-label';
            label.textContent = bbox.confidence ? `${Math.round(bbox.confidence)}%` : `Box ${bboxData.indexOf(bbox) + 1}`;
            boxDiv.appendChild(label);
            
            document.getElementById('bboxOverlays').appendChild(boxDiv);
        }
        
        function addResizeHandles(element) {
            const handles = ['nw', 'ne', 'sw', 'se'];
            handles.forEach(pos => {
                const handle = document.createElement('div');
                handle.className = `resize-handle ${pos}`;
                handle.onmousedown = (e) => startResize(e, pos, element);
                element.appendChild(handle);
            });
        }
        
        function makeDraggable(element, bbox) {
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            
            element.onmousedown = dragStart;
            
            function dragStart(e) {
                if (e.target.classList.contains('resize-handle')) return;
                
                initialX = e.clientX - element.offsetLeft;
                initialY = e.clientY - element.offsetTop;
                
                isDragging = true;
                
                document.onmousemove = drag;
                document.onmouseup = dragEnd;
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                
                element.style.left = currentX + 'px';
                element.style.top = currentY + 'px';
                
                // bbox ë°ì´í„° ì—…ë°ì´íŠ¸
                bbox.x = currentX;
                bbox.y = currentY;
            }
            
            function dragEnd() {
                isDragging = false;
                document.onmousemove = null;
                document.onmouseup = null;
                updateBoundingBoxList();
            }
        }
        
        function startResize(e, handle, element) {
            e.stopPropagation();
            const bbox = bboxData.find(b => b.id === parseInt(element.id.replace('bbox-', '')));
            if (!bbox) return;
            
            const startX = e.clientX;
            const startY = e.clientY;
            const startWidth = parseInt(element.style.width);
            const startHeight = parseInt(element.style.height);
            const startLeft = parseInt(element.style.left);
            const startTop = parseInt(element.style.top);
            
            document.onmousemove = (e) => {
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                
                switch(handle) {
                    case 'se':
                        element.style.width = Math.max(20, startWidth + dx) + 'px';
                        element.style.height = Math.max(20, startHeight + dy) + 'px';
                        bbox.width = Math.max(20, startWidth + dx);
                        bbox.height = Math.max(20, startHeight + dy);
                        break;
                    case 'sw':
                        element.style.width = Math.max(20, startWidth - dx) + 'px';
                        element.style.height = Math.max(20, startHeight + dy) + 'px';
                        element.style.left = Math.min(startLeft + startWidth - 20, startLeft + dx) + 'px';
                        bbox.width = Math.max(20, startWidth - dx);
                        bbox.height = Math.max(20, startHeight + dy);
                        bbox.x = parseInt(element.style.left);
                        break;
                    case 'ne':
                        element.style.width = Math.max(20, startWidth + dx) + 'px';
                        element.style.height = Math.max(20, startHeight - dy) + 'px';
                        element.style.top = Math.min(startTop + startHeight - 20, startTop + dy) + 'px';
                        bbox.width = Math.max(20, startWidth + dx);
                        bbox.height = Math.max(20, startHeight - dy);
                        bbox.y = parseInt(element.style.top);
                        break;
                    case 'nw':
                        element.style.width = Math.max(20, startWidth - dx) + 'px';
                        element.style.height = Math.max(20, startHeight - dy) + 'px';
                        element.style.left = Math.min(startLeft + startWidth - 20, startLeft + dx) + 'px';
                        element.style.top = Math.min(startTop + startHeight - 20, startTop + dy) + 'px';
                        bbox.width = Math.max(20, startWidth - dx);
                        bbox.height = Math.max(20, startHeight - dy);
                        bbox.x = parseInt(element.style.left);
                        bbox.y = parseInt(element.style.top);
                        break;
                }
            };
            
            document.onmouseup = () => {
                document.onmousemove = null;
                document.onmouseup = null;
                updateBoundingBoxList();
            };
        }
        
        function setQuickLabel(labelText) {
            if (!selectedBoxId) {
                showAlert('ë¨¼ì € Bounding Boxë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const bbox = bboxData.find(b => b.id === selectedBoxId);
            if (bbox) {
                bbox.label = labelText;
                document.getElementById(`bbox-label-${selectedBoxId}`).value = labelText;
                showAlert(`ë¼ë²¨ì´ '${labelText}'ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            }
        }
        
        // ê·¸ë£¹ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function toggleGroupMode() {
            groupMode = !groupMode;
            const btn = document.getElementById('groupModeBtn');
            if (groupMode) {
                btn.textContent = 'ğŸ”— ê·¸ë£¹ ëª¨ë“œ ON';
                btn.style.background = '#4caf50';
                showAlert('ê·¸ë£¹ ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ê°™ì€ í–‰ì˜ ë¼ë²¨ë“¤ì´ ìë™ìœ¼ë¡œ ê·¸ë£¹í™”ë©ë‹ˆë‹¤.', 'info');
            } else {
                btn.textContent = 'ğŸ”— ê·¸ë£¹ ëª¨ë“œ OFF';
                btn.style.background = '';
                showAlert('ê·¸ë£¹ ëª¨ë“œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }
        
        function selectRowByY(yPosition, threshold = 15) {
            // Yì¢Œí‘œê°€ ë¹„ìŠ·í•œ ëª¨ë“  bbox ì„ íƒ
            const rowBboxes = bboxData.filter(bbox => 
                Math.abs(bbox.y - yPosition) <= threshold
            );
            
            if (rowBboxes.length > 0) {
                // ìƒˆ ê·¸ë£¹ ID ìƒì„±
                const groupId = `item_${Date.now()}`;
                currentGroupId = groupId;
                
                // ì„ íƒëœ í–‰ì˜ ëª¨ë“  bboxì— ê·¸ë£¹ ID í• ë‹¹
                rowBboxes.forEach(bbox => {
                    bbox.group_id = groupId;
                    // ì‹œê°ì  í‘œì‹œ
                    const element = document.getElementById(`bbox-${bbox.id}`);
                    if (element) {
                        element.style.border = '3px solid #ff9800';
                        element.style.backgroundColor = 'rgba(255, 152, 0, 0.1)';
                    }
                });
                
                showAlert(`${rowBboxes.length}ê°œì˜ ë¼ë²¨ì´ ê·¸ë£¹ ${groupId}ë¡œ ë¬¶ì˜€ìŠµë‹ˆë‹¤.`, 'success');
                updateBboxList();
            }
        }
        
        function autoGroupByRows() {
            // ëª¨ë“  bboxë¥¼ Yì¢Œí‘œ ê¸°ì¤€ìœ¼ë¡œ ìë™ ê·¸ë£¹í•‘
            if (bboxData.length === 0) {
                showAlert('ê·¸ë£¹í™”í•  ë¼ë²¨ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }
            
            // Yì¢Œí‘œë¡œ ì •ë ¬
            const sortedBboxes = [...bboxData].sort((a, b) => a.y - b.y);
            
            let groups = [];
            let currentGroup = [];
            let currentGroupY = null;
            let groupId = 1;
            const yThreshold = 15;
            
            sortedBboxes.forEach(bbox => {
                if (currentGroupY === null || Math.abs(bbox.y - currentGroupY) <= yThreshold) {
                    if (currentGroupY === null) currentGroupY = bbox.y;
                    currentGroup.push(bbox);
                } else {
                    // ìƒˆ ê·¸ë£¹ ì‹œì‘
                    if (currentGroup.length > 0) {
                        const gId = `item_${String(groupId).padStart(5, '0')}`;
                        currentGroup.forEach(b => b.group_id = gId);
                        groups.push({id: gId, items: currentGroup});
                        groupId++;
                    }
                    currentGroup = [bbox];
                    currentGroupY = bbox.y;
                }
            });
            
            // ë§ˆì§€ë§‰ ê·¸ë£¹ ì²˜ë¦¬
            if (currentGroup.length > 0) {
                const gId = `item_${String(groupId).padStart(5, '0')}`;
                currentGroup.forEach(b => b.group_id = gId);
                groups.push({id: gId, items: currentGroup});
            }
            
            showAlert(`${groups.length}ê°œì˜ ê·¸ë£¹ìœ¼ë¡œ ìë™ ë¶„ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            updateBboxList();
            highlightGroups();
        }
        
        // ê·¸ë£¹ ëª¨ë“œ í† ê¸€
        function toggleGroupMode() {
            groupMode = !groupMode;
            const btn = document.getElementById('groupModeBtn');
            const panel = document.getElementById('groupManagementPanel');
            
            if (groupMode) {
                btn.innerHTML = '<span>ğŸ”—</span> ê·¸ë£¹ ëª¨ë“œ ON';
                btn.classList.remove('btn-info');
                btn.classList.add('btn-success');
                panel.style.display = 'block';
                updateGroupSelect();
            } else {
                btn.innerHTML = '<span>ğŸ”—</span> ê·¸ë£¹ ëª¨ë“œ OFF';
                btn.classList.remove('btn-success');
                btn.classList.add('btn-info');
                panel.style.display = 'none';
            }
        }
        
        // ê·¸ë£¹ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateGroupSelect() {
            const select = document.getElementById('currentGroupSelect');
            select.innerHTML = '<option value="">ê·¸ë£¹ ì„ íƒ...</option>';
            
            // ê¸°ì¡´ ê·¸ë£¹ ëª©ë¡ ìƒì„±
            const groups = new Set();
            bboxData.forEach(bbox => {
                if (bbox.group_id) {
                    groups.add(bbox.group_id);
                }
            });
            
            // ì •ë ¬í•˜ì—¬ ì˜µì…˜ ì¶”ê°€
            Array.from(groups).sort().forEach(groupId => {
                const option = document.createElement('option');
                option.value = groupId;
                option.textContent = groupId;
                select.appendChild(option);
            });
        }
        
        // ê·¸ë£¹ ì„ íƒ
        function selectGroup(groupId) {
            currentGroupId = groupId;
            const btn = document.getElementById('addToGroupBtn');
            btn.disabled = !groupId;
            
            if (groupId) {
                // ì„ íƒëœ ê·¸ë£¹ì˜ bboxë“¤ì„ í•˜ì´ë¼ì´íŠ¸
                bboxData.forEach(bbox => {
                    const element = document.getElementById(`bbox-${bbox.id}`);
                    if (element) {
                        if (bbox.group_id === groupId) {
                            element.style.border = '3px solid #ff9800';
                            element.style.backgroundColor = 'rgba(255, 152, 0, 0.2)';
                        } else {
                            element.style.border = '2px solid #4caf50';
                            element.style.backgroundColor = 'rgba(76, 175, 80, 0.1)';
                        }
                    }
                });
            }
        }
        
        // ìƒˆ ê·¸ë£¹ ìƒì„±
        function createNewGroup() {
            const timestamp = Date.now();
            const groupId = `item_${String(timestamp).slice(-5).padStart(5, '0')}`;
            currentGroupId = groupId;
            
            // ë“œë¡­ë‹¤ìš´ì— ì¶”ê°€
            const select = document.getElementById('currentGroupSelect');
            const option = document.createElement('option');
            option.value = groupId;
            option.textContent = groupId;
            select.appendChild(option);
            select.value = groupId;
            
            document.getElementById('addToGroupBtn').disabled = false;
            showAlert(`ìƒˆ ê·¸ë£¹ '${groupId}'ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }
        
        // ì„ íƒëœ í•­ëª©ì„ í˜„ì¬ ê·¸ë£¹ì— ì¶”ê°€
        function addToCurrentGroup() {
            if (!currentGroupId) {
                showAlert('ë¨¼ì € ê·¸ë£¹ì„ ì„ íƒí•˜ì„¸ìš”.', 'error');
                return;
            }
            
            if (!selectedBoxId) {
                showAlert('ê·¸ë£¹ì— ì¶”ê°€í•  bboxë¥¼ ì„ íƒí•˜ì„¸ìš”.', 'error');
                return;
            }
            
            const bbox = bboxData.find(b => b.id === selectedBoxId);
            if (bbox) {
                bbox.group_id = currentGroupId;
                
                // ì‹œê°ì  ì—…ë°ì´íŠ¸
                const element = document.getElementById(`bbox-${bbox.id}`);
                if (element) {
                    element.style.border = '3px solid #ff9800';
                    element.style.backgroundColor = 'rgba(255, 152, 0, 0.2)';
                }
                
                updateBboxList();
                showAlert(`í•­ëª©ì´ ê·¸ë£¹ '${currentGroupId}'ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            }
        }
        
        // ê·¸ë£¹ì—ì„œ ì œê±°
        function removeFromGroup() {
            if (!selectedBoxId) {
                showAlert('ê·¸ë£¹ì—ì„œ ì œê±°í•  bboxë¥¼ ì„ íƒí•˜ì„¸ìš”.', 'error');
                return;
            }
            
            const bbox = bboxData.find(b => b.id === selectedBoxId);
            if (bbox && bbox.group_id) {
                const groupId = bbox.group_id;
                delete bbox.group_id;
                
                // ì‹œê°ì  ì—…ë°ì´íŠ¸
                const element = document.getElementById(`bbox-${bbox.id}`);
                if (element) {
                    element.style.border = '2px solid #4caf50';
                    element.style.backgroundColor = 'rgba(76, 175, 80, 0.1)';
                }
                
                updateBboxList();
                showAlert(`í•­ëª©ì´ ê·¸ë£¹ '${groupId}'ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            }
        }
        
        function highlightGroups() {
            // ê·¸ë£¹ë³„ë¡œ ë‹¤ë¥¸ ìƒ‰ìƒìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸
            const colors = ['#4caf50', '#2196f3', '#ff9800', '#9c27b0', '#f44336'];
            const groups = {};
            
            // ê·¸ë£¹ë³„ë¡œ ë¶„ë¥˜ (group_idê°€ "-"ì¸ ê²ƒì€ ì œì™¸)
            bboxData.forEach(bbox => {
                if (bbox.group_id && bbox.group_id !== '-') {
                    if (!groups[bbox.group_id]) {
                        groups[bbox.group_id] = [];
                    }
                    groups[bbox.group_id].push(bbox);
                }
            });
            
            // ë¨¼ì € ëª¨ë“  bboxë¥¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ë¡œ ë¦¬ì…‹
            bboxData.forEach(bbox => {
                const element = document.getElementById(`bbox-${bbox.id}`);
                if (element) {
                    if (!bbox.group_id || bbox.group_id === '-') {
                        // ê·¸ë£¹ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ìŠ¤íƒ€ì¼
                        element.style.border = '2px solid #4caf50';
                        element.style.backgroundColor = 'rgba(76, 175, 80, 0.1)';
                    }
                }
            });
            
            // ê° ê·¸ë£¹ì— ìƒ‰ìƒ í• ë‹¹
            let colorIndex = 0;
            Object.keys(groups).forEach(groupId => {
                const color = colors[colorIndex % colors.length];
                groups[groupId].forEach(bbox => {
                    const element = document.getElementById(`bbox-${bbox.id}`);
                    if (element) {
                        element.style.border = `2px solid ${color}`;
                        element.style.backgroundColor = `${color}20`;
                    }
                });
                colorIndex++;
            });
        }
        
        function updateBboxList() {
            // Bounding Box ëª©ë¡ ì—…ë°ì´íŠ¸
            const listDiv = document.getElementById('bboxList');
            if (!listDiv) return;
            
            if (bboxData.length === 0) {
                listDiv.innerHTML = '<p>ê·¸ë ¤ì§„ Bounding Boxê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ê·¸ë£¹ë³„ë¡œ ì •ë ¬
            const groups = {};
            const ungrouped = [];
            
            bboxData.forEach(bbox => {
                if (bbox.group_id && bbox.group_id !== '-') {
                    if (!groups[bbox.group_id]) {
                        groups[bbox.group_id] = [];
                    }
                    groups[bbox.group_id].push(bbox);
                } else {
                    ungrouped.push(bbox);
                }
            });
            
            let html = '<div style="max-height: 400px; overflow-y: auto;">';
            
            // ê·¸ë£¹í™”ëœ í•­ëª© í‘œì‹œ
            Object.keys(groups).forEach(groupId => {
                html += `<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer;" onclick="selectGroup('${groupId}')">`;
                html += `<h5 style="margin: 0 0 10px 0;">ğŸ“¦ ${groupId}</h5>`;
                
                groups[groupId].forEach((bbox, index) => {
                    html += `
                        <div style="margin-left: 20px; margin-bottom: 5px; cursor: pointer;" onclick="selectBoundingBox(${bbox.id}); event.stopPropagation();">
                            <span>${index + 1}. ${bbox.label || '(ë¼ë²¨ ì—†ìŒ)'}</span>
                            <span style="color: #666;"> - ${bbox.text || ''}</span>
                        </div>
                    `;
                });
                html += '</div>';
            });
            
            // ê·¸ë£¹í™”ë˜ì§€ ì•Šì€ í•­ëª© í‘œì‹œ
            if (ungrouped.length > 0) {
                html += '<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ffc107; border-radius: 5px;">';
                html += '<h5 style="margin: 0 0 10px 0;">ğŸ“ ê·¸ë£¹ ë¯¸ì§€ì •</h5>';
                
                ungrouped.forEach((bbox, index) => {
                    html += `
                        <div style="margin-left: 20px; margin-bottom: 5px; cursor: pointer;" onclick="selectBoundingBox(${bbox.id})">
                            <span>${index + 1}. ${bbox.label || '(ë¼ë²¨ ì—†ìŒ)'}</span>
                            <span style="color: #666;"> - ${bbox.text || ''}</span>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            html += '</div>';
            listDiv.innerHTML = html;
            
            // ê·¸ë£¹ ëª¨ë“œê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ê·¸ë£¹ ì„ íƒ ë“œë¡­ë‹¤ìš´ë„ ì—…ë°ì´íŠ¸
            if (groupMode) {
                updateGroupSelect();
            }
        }
        
        async function saveCurrentLabelData() {
            if (!currentLabelData) {
                showAlert('ì €ì¥í•  ë¼ë²¨ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                // í˜„ì¬ bbox ë°ì´í„° ìˆ˜ì§‘ (ê·¸ë£¹ ì •ë³´ í¬í•¨)
                const labelData = {
                    filename: currentLabelData.filename,
                    filepath: currentLabelData.filepath,
                    pageNumber: currentPdfPage,  // í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ ì¶”ê°€
                    class: document.getElementById('documentClass').value,
                    bboxData: bboxData
                };
                
                const response = await fetch('/api/labels', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(labelData)
                });
                
                if (response.ok) {
                    showAlert('ë¼ë²¨ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    
                    // ìë™ ëª¨ë¸ ì—…ë°ì´íŠ¸ ë¹„í™œì„±í™” - ìˆ˜ë™ìœ¼ë¡œë§Œ í•™ìŠµ ì‹¤í–‰
                    // updateModelIncrementally(labelData);
                } else {
                    const error = await response.json();
                    showAlert(`ì €ì¥ ì‹¤íŒ¨: ${error.error}`, 'error');
                }
            } catch (error) {
                showAlert(`ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error}`, 'error');
            }
        }
        
        // ìˆ˜ì§‘ëœ íŒŒì¼ ì‚­ì œ
        async function deleteCollectedFile(filePath, fileName) {
            if (!confirm(`ì •ë§ë¡œ '${fileName}' íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê´€ë ¨ëœ ëª¨ë“  íŒŒì¼(ì´ë¯¸ì§€, ë¼ë²¨ ë“±)ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/delete/collected/${encodeURIComponent(filePath)}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showAlert(`${fileName} íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                    
                    // íŒŒì¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    refreshFiles();
                } else {
                    const error = await response.json();
                    showAlert(`íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨: ${error.error}`, 'error');
                }
            } catch (error) {
                showAlert(`íŒŒì¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜: ${error}`, 'error');
            }
        }
        
        // PDF ì •ë³´ ë¡œë“œ
        async function loadPdfInfo(filename) {
            try {
                console.log(`Loading PDF info for: ${filename}`);
                
                // PDF íŒŒì¼ëª…ì—ì„œ stem ì¶”ì¶œ (í™•ì¥ì ì œê±°)
                const pdfStem = filename.replace('.pdf', '').replace('.PDF', '');
                
                // API í˜¸ì¶œ
                const response = await fetch(`/api/pdf_info/${encodeURIComponent(filename)}`);
                
                if (response.ok) {
                    const data = await response.json();
                    totalPdfPages = data.page_count || 1;
                    console.log(`PDF API returned ${totalPdfPages} pages for ${filename}`);
                }
                
                // PNG í”„ë¦¬í”½ìŠ¤ë¥¼ ì‚¬ìš©í•´ì„œ ì‹¤ì œ í˜ì´ì§€ ìˆ˜ í™•ì¸
                if (currentPngPrefix) {
                    console.log(`Checking actual pages using PNG prefix: ${currentPngPrefix}`);
                    let maxPage = 1;
                    
                    // ìµœëŒ€ 20í˜ì´ì§€ê¹Œì§€ í™•ì¸
                    for (let i = 1; i <= 20; i++) {
                        const pagePath = `/api/view/${currentPngPrefix}_page_${String(i).padStart(3, '0')}.png`;
                        try {
                            const imgResponse = await fetch(pagePath, { method: 'HEAD' });
                            if (imgResponse.ok) {
                                maxPage = i;
                                console.log(`Found page ${i}`);
                            } else {
                                // ì—°ì†ëœ í˜ì´ì§€ê°€ ì—†ìœ¼ë©´ ì¤‘ë‹¨
                                break;
                            }
                        } catch (e) {
                            break;
                        }
                    }
                    
                    if (maxPage > totalPdfPages) {
                        totalPdfPages = maxPage;
                        console.log(`Updated total pages to ${totalPdfPages} based on PNG files`);
                    }
                }
                
                updatePageInfo();
            } catch (error) {
                console.error('PDF ì •ë³´ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                // ê¸°ë³¸ê°’ ì„¤ì •
                totalPdfPages = 1;
                updatePageInfo();
            }
        }
        
        // í˜ì´ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
        function updatePageInfo() {
            document.getElementById('pageInfo').textContent = `${currentPdfPage} / ${totalPdfPages}`;
            
            // ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            document.getElementById('prevPageBtn').disabled = currentPdfPage <= 1;
            document.getElementById('nextPageBtn').disabled = currentPdfPage >= totalPdfPages;
        }
        
        // ì´ì „ í˜ì´ì§€ë¡œ ì´ë™
        function previousPage() {
            if (currentPdfPage > 1) {
                currentPdfPage--;
                loadPdfPage(currentPdfPage);
            }
        }
        
        // ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™
        function nextPage() {
            if (currentPdfPage < totalPdfPages) {
                currentPdfPage++;
                loadPdfPage(currentPdfPage);
            }
        }
        
        // íŠ¹ì • PDF í˜ì´ì§€ ë¡œë“œ
        async function loadPdfPage(pageNum) {
            if (!currentPdfFile) return;
            
            // bbox ì´ˆê¸°í™”
            bboxData = [];
            document.getElementById('bboxOverlays').innerHTML = '';
            updateBoundingBoxList();
            
            // ìƒˆ í˜ì´ì§€ ì´ë¯¸ì§€ ë¡œë“œ
            const img = document.getElementById('labelingImage');
            let imagePath;
            
            // PNG í”„ë¦¬í”½ìŠ¤ê°€ ìˆìœ¼ë©´ ì§ì ‘ PNG íŒŒì¼ ê²½ë¡œ ì‚¬ìš©
            if (currentPngPrefix) {
                const pageStr = String(pageNum).padStart(3, '0');
                imagePath = `/api/view/${currentPngPrefix}_page_${pageStr}.png`;
                console.log(`Loading PNG directly: ${imagePath}`);
            } else {
                // í”„ë¦¬í”½ìŠ¤ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ ì‚¬ìš©
                imagePath = `/api/pdf_to_image/${encodeURIComponent(currentPdfFile)}?page=${pageNum}`;
                console.log(`Loading via PDF conversion: ${imagePath}`);
            }
            
            console.log(`Loading PDF page ${pageNum}: ${imagePath}`);
            
            // ì„±ê³µ í•¸ë“¤ëŸ¬ ì¶”ê°€
            img.onload = function() {
                console.log(`Page ${pageNum} loaded successfully`);
                // ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ í¬ê¸° ì¡°ì •
                const container = document.getElementById('imageContainer');
                container.style.width = img.naturalWidth + 'px';
                container.style.height = img.naturalHeight + 'px';
            };
            
            // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ì²˜ë¦¬
            img.onerror = function() {
                console.error(`Failed to load page ${pageNum}, trying alternative path`);
                // pdf_to_image ì—”ë“œí¬ì¸íŠ¸ë¡œ ì¬ì‹œë„
                if (!imagePath.includes('pdf_to_image')) {
                    const altPath = `/api/pdf_to_image/${encodeURIComponent(currentPdfFile)}?page=${pageNum}`;
                    console.log(`Retrying with pdf_to_image endpoint: ${altPath}`);
                    img.src = altPath;
                } else {
                    showAlert('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                }
            };
            
            img.src = imagePath;
            
            updatePageInfo();
            
            // í˜„ì¬ í˜ì´ì§€ì˜ ë¼ë²¨ ë°ì´í„° ë¡œë“œ
            try {
                // íƒ€ì„ìŠ¤íƒ¬í”„ê°€ í¬í•¨ëœ ì „ì²´ íŒŒì¼ëª…ì„ ì‚¬ìš©í•˜ì—¬ ë¼ë²¨ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
                const filenameForLabels = currentFullFilename || currentPdfFile;
                const response = await fetch(`/api/labels/${encodeURIComponent(filenameForLabels)}?page=${pageNum}`);
                console.log('Label API URL:', `/api/labels/${encodeURIComponent(filenameForLabels)}?page=${pageNum}`);
                console.log('Label response status:', response.status);
                if (response.ok) {
                    const data = await response.json();
                    console.log('Label data received:', data);
                    console.log('Has bboxes?', data.bboxes ? 'Yes' : 'No');
                    console.log('Bboxes is array?', Array.isArray(data.bboxes));
                    console.log('Bboxes length:', data.bboxes ? data.bboxes.length : 0);
                    
                    // ë¬¸ì„œ í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸
                    if (data.class) {
                        document.getElementById('documentClass').value = data.class;
                    }
                    
                    // PNG í”„ë¦¬í”½ìŠ¤ ì—…ë°ì´íŠ¸ (ìƒˆ í˜ì´ì§€ì˜ ì´ë¯¸ì§€ ê²½ë¡œì—ì„œ ì¶”ì¶œ)
                    if (data.image_path) {
                        const match = data.image_path.match(/\/(\d{8}_\d{6}_[^/]+)_page_/);
                        if (match) {
                            currentPngPrefix = match[1];
                            console.log(`PNG prefix updated for page ${pageNum}: ${currentPngPrefix}`);
                        }
                    }
                    
                    // bbox ë°ì´í„° í‘œì‹œ
                    if (data.bboxes && Array.isArray(data.bboxes)) {
                        displayExistingBboxes(data.bboxes);
                    }
                }
            } catch (error) {
                console.error('Failed to load label data for page', error);
            }
        }
        
        // ìë™ ë¼ë²¨ ì œì•ˆ ê°€ì ¸ì˜¤ê¸°
        async function getAutoLabels() {
            if (!currentLabelData || !currentLabelData.filename) {
                showAlert('ë¨¼ì € íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/auto_label/${encodeURIComponent(currentLabelData.filename)}`);
                const data = await response.json();
                
                if (!response.ok) {
                    showAlert(data.error || 'ìë™ ë¼ë²¨ ì œì•ˆì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                
                if (data.suggestions && data.suggestions.length > 0) {
                    // ì œì•ˆëœ bbox í‘œì‹œ
                    displaySuggestedBboxes(data.suggestions);
                    showAlert(`${data.suggestions.length}ê°œì˜ ë¼ë²¨ì´ ìë™ìœ¼ë¡œ ì œì•ˆë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                } else {
                    showAlert('ì œì•ˆí•  ë¼ë²¨ì´ ì—†ìŠµë‹ˆë‹¤. ëª¨ë¸ í•™ìŠµì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'info');
                }
                
                // ëª¨ë¸ í†µê³„ í‘œì‹œ
                if (data.model_stats && !data.model_stats.is_trained) {
                    showAlert('ëª¨ë¸ì´ ì•„ì§ í•™ìŠµë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¼ë²¨ë§ í›„ ëª¨ë¸ í•™ìŠµì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.', 'warning');
                }
                
            } catch (error) {
                showAlert(`ìë™ ë¼ë²¨ ì œì•ˆ ì¤‘ ì˜¤ë¥˜: ${error}`, 'error');
            }
        }
        
        // ì œì•ˆëœ bbox í‘œì‹œ
        function displaySuggestedBboxes(suggestions) {
            suggestions.forEach((suggestion, index) => {
                // í˜„ì¬ í˜ì´ì§€ì˜ ì œì•ˆë§Œ í‘œì‹œ
                if (suggestion.page !== currentPdfPage) return;
                
                const bbox = {
                    id: Date.now() + index,
                    x: suggestion.x,
                    y: suggestion.y,
                    width: suggestion.width,
                    height: suggestion.height,
                    text: suggestion.text,
                    label: suggestion.label,
                    confidence: suggestion.confidence,
                    is_suggestion: true
                };
                
                bboxData.push(bbox);
                createSuggestedBboxElement(bbox);
            });
            
            updateBoundingBoxList();
        }
        
        // ì œì•ˆëœ bbox ìš”ì†Œ ìƒì„±
        function createSuggestedBboxElement(bbox) {
            const boxDiv = document.createElement('div');
            boxDiv.className = 'bbox-overlay suggested';
            boxDiv.id = 'bbox-' + bbox.id;
            boxDiv.style.left = bbox.x + 'px';
            boxDiv.style.top = bbox.y + 'px';
            boxDiv.style.width = bbox.width + 'px';
            boxDiv.style.height = bbox.height + 'px';
            
            // resize handles ì¶”ê°€
            addResizeHandles(boxDiv);
            makeDraggable(boxDiv, bbox);
            
            boxDiv.onclick = (e) => {
                if (!e.target.classList.contains('resize-handle')) {
                    selectBoundingBox(bbox.id);
                }
            };
            
            // ë¼ë²¨ í‘œì‹œ
            const label = document.createElement('div');
            label.className = 'bbox-label';
            label.textContent = bbox.label || 'Unknown';
            boxDiv.appendChild(label);
            
            // ì‹ ë¢°ë„ í‘œì‹œ
            if (bbox.confidence) {
                const confidence = document.createElement('div');
                confidence.className = 'confidence-badge';
                confidence.textContent = `${Math.round(bbox.confidence * 100)}%`;
                boxDiv.appendChild(confidence);
            }
            
            document.getElementById('bboxOverlays').appendChild(boxDiv);
        }
        
        // ëª¨ë¸ í•™ìŠµ
        async function trainModel() {
            if (!confirm('í˜„ì¬ê¹Œì§€ ë¼ë²¨ë§ëœ ëª¨ë“  ë°ì´í„°ë¡œ ëª¨ë¸ì„ í•™ìŠµí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                showAlert('ëª¨ë¸ í•™ìŠµì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
                
                const response = await fetch('/api/train_model', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (response.ok && result.status === 'success') {
                    showAlert(`ëª¨ë¸ í•™ìŠµ ì™„ë£Œ! ì´ ${result.total_samples}ê°œ ìƒ˜í”Œ, ${result.unique_labels}ê°œ ë¼ë²¨ í´ë˜ìŠ¤`, 'success');
                } else {
                    showAlert(result.message || 'ëª¨ë¸ í•™ìŠµ ì‹¤íŒ¨', 'error');
                }
                
            } catch (error) {
                showAlert(`ëª¨ë¸ í•™ìŠµ ì¤‘ ì˜¤ë¥˜: ${error}`, 'error');
            }
        }
        
        // ëª¨ë¸ í†µê³„ í‘œì‹œ
        async function showModelStats() {
            try {
                const response = await fetch('/api/model_stats');
                const stats = await response.json();
                
                if (response.ok) {
                    let message = 'ëª¨ë¸ í†µê³„:\n';
                    message += `- í•™ìŠµ ìƒíƒœ: ${stats.is_trained ? 'í•™ìŠµë¨' : 'ë¯¸í•™ìŠµ'}\n`;
                    
                    if (stats.training_stats) {
                        message += `- ì´ ìƒ˜í”Œ ìˆ˜: ${stats.training_stats.total_samples}\n`;
                        message += `- ë§ˆì§€ë§‰ í•™ìŠµ: ${stats.training_stats.last_training_time || 'N/A'}\n`;
                        message += `- ë¼ë²¨ ë¶„í¬:\n`;
                        
                        for (const [label, count] of Object.entries(stats.training_stats.label_distribution || {})) {
                            message += `  â€¢ ${label}: ${count}ê°œ\n`;
                        }
                    }
                    
                    alert(message);
                } else {
                    showAlert('ëª¨ë¸ í†µê³„ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                }
                
            } catch (error) {
                showAlert(`í†µê³„ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜: ${error}`, 'error');
            }
        }
        
        // ì ì§„ì  ëª¨ë¸ ì—…ë°ì´íŠ¸
        async function updateModelIncrementally(newAnnotation) {
            try {
                // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ëª¨ë¸ ì—…ë°ì´íŠ¸
                const response = await fetch('/api/train_model', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        incremental: true,
                        annotation: newAnnotation
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.status === 'success') {
                        console.log('ëª¨ë¸ì´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }
                }
            } catch (error) {
                console.error('ëª¨ë¸ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }
    </script>
</body>
</html>