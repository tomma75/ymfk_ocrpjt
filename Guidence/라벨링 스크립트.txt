  ğŸš¨ ì ˆëŒ€ ê·œì¹™ - ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•  ì‚¬í•­

  1. ì¢Œí‘œ ì‹œìŠ¤í…œ ì´í•´

  ì´ë¯¸ì§€ í¬ê¸°: 2481 x 3510 pixels (ê³ ì •)
  ì¢Œí‘œ ì›ì : ì™¼ìª½ ìƒë‹¨ (0,0)
  bbox í˜•ì‹: [x, y, width, height] - ì‹¤ì œ í”½ì…€ ì¢Œí‘œ

  í‘œì¤€ Y ì¢Œí‘œ ì°¸ì¡°ê°’:
  - Order number: Y=70~105 (í‰ê·  100)
  - Case mark/Shipping line: Y=1300~1500
  - Item number: Y=1680~1730
  - Part number: Y=1690~1730
  - Shipping date: Y=1790~1820
  - Quantity: Y=1795~1820
  - Unit price: Y=1795~1820
  - Total: Y=2100~2135

  2. ì¹˜ëª…ì  ì‹¤ìˆ˜ ë°©ì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸

  CRITICAL_MISTAKES = {
      "ì‹¤ìˆ˜1": "ì´ë¯¸ì§€ë¥¼ ë³´ì§€ ì•Šê³  íŒ¨í„´ë§Œ ë”°ë¥´ê¸°",
      "ë°©ì§€ì±…": "ê° í˜ì´ì§€ ì´ë¯¸ì§€ë¥¼ ë°˜ë“œì‹œ ê°œë³„ í™•ì¸",

      "ì‹¤ìˆ˜2": "Case markì™€ Shipping line ìœ„ì¹˜ ê°€ì •",
      "ë°©ì§€ì±…": "ì‹¤ì œ ìœ„ì¹˜ í™•ì¸ - ì™¼ìª½/ì¤‘ì•™/ì˜¤ë¥¸ìª½ ëª¨ë‘ ê°€ëŠ¥",

      "ì‹¤ìˆ˜3": "í…ìŠ¤íŠ¸ë¥¼ ì˜ëª» ì½ê¸°",
      "ë°©ì§€ì±…": "SHISAKU-1_ ê°™ì€ ë¶ˆí•„ìš”í•œ ì ‘ë‘ì‚¬ ì¶”ê°€ ê¸ˆì§€",

      "ì‹¤ìˆ˜4": "ìˆ«ì ì˜¤íƒ€",
      "ë°©ì§€ì±…": "48.000 vs 46.000 - ì •í™•í•œ ìˆ«ì í™•ì¸",

      "ì‹¤ìˆ˜5": "ë¶ˆí•„ìš”í•œ ë¼ë²¨ ì¶”ê°€",
      "ë°©ì§€ì±…": "Special instruction, Material code ë“± ì—†ìœ¼ë©´ ì¶”ê°€ ê¸ˆì§€"
  }

  ğŸ“ Case Markì™€ Shipping Line êµ¬ë¶„ (ìµœì¤‘ìš”! - ìˆ˜ì •ë¨)

  ì˜¬ë°”ë¥¸ êµ¬ë¶„ ê·œì¹™:

  Shipping line = 8ìë¦¬ ì˜ìˆ«ì íŒ¨í„´ (ëŒ€ë¬¸ì+ìˆ«ì ì¡°í•©)
    - íŒ¨í„´: [A-Z][0-9]{7} ë˜ëŠ” ìœ ì‚¬í•œ í˜•íƒœ
    - ì˜ˆ: C5800002, D4700001, A1234567

  Case mark = ì£¼ì†Œ/ìœ„ì¹˜/ì´ë¦„ ì •ë³´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í…ìŠ¤íŠ¸
    - íŠ¹ì§•: ì§€ëª…, ê±´ë¬¼ëª…, ì½”ë“œ, ìœ„ì¹˜ ì •ë³´ ë“±
    - í˜•íƒœ: ë³´í†µ ì—¬ëŸ¬ ë‹¨ì–´ ì¡°í•©ì´ë‚˜ ì£¼ì†Œ í˜•ì‹

  ì˜ˆì‹œ 1:
  "C5800002 ISHIKAWA EXT:731-48177LOC:K70-4"
  â†’ Shipping line: "C5800002" (8ìë¦¬ ì½”ë“œ)
  â†’ Case mark: "ISHIKAWA EXT:731-48177LOC:K70-4" (ìœ„ì¹˜/ì£¼ì†Œ ì •ë³´)

  ì˜ˆì‹œ 2:
  "YMG KOFU-SHI K5"
  â†’ Case mark: "YMG KOFU-SHI K5" (ì§€ëª…/ìœ„ì¹˜ ì •ë³´)

  ì˜ˆì‹œ 3:
  "YMG KOFU P/C K8-2 KOSUGE 731-48176"
  â†’ Case mark: ì „ì²´ (ì£¼ì†Œ/ìœ„ì¹˜ ì •ë³´)

  ì˜ˆì‹œ 4:
  "D4700003"
  â†’ Shipping line: "D4700003" (8ìë¦¬ ì½”ë“œ)

  Shipping Line íŒ¨í„´ ì¸ì‹:

  def is_shipping_line(text):
      """Shipping line íŒ¨í„´ í™•ì¸"""
      import re

      # 8ìë¦¬ ì˜ìˆ«ì íŒ¨í„´ (ëŒ€ë¬¸ìë¡œ ì‹œì‘, ìˆ«ì 7ìë¦¬)
      pattern1 = r'^[A-Z]\d{7}$'

      # ë³€í˜• íŒ¨í„´ (ì˜ë¬¸ì+ìˆ«ì ì¡°í•© 8ìë¦¬)
      pattern2 = r'^[A-Z0-9]{8}$'

      return bool(re.match(pattern1, text) or
                  (re.match(pattern2, text) and
                   any(c.isdigit() for c in text)))

  # ì˜ˆì‹œ
  is_shipping_line("C5800002")  # True
  is_shipping_line("ISHIKAWA")  # False
  is_shipping_line("YMG")       # False

  Case Mark íŒ¨í„´ ì¸ì‹:

  def is_case_mark(text):
      """Case mark íŠ¹ì§• í™•ì¸"""
      case_mark_keywords = [
          # ì§€ëª…/ë„ì‹œ
          "KOFU", "ISHIKAWA", "KOSUGE", "TOKYO",
          # ê±´ë¬¼/ìœ„ì¹˜ ì½”ë“œ
          "EXT:", "LOC:", "K5", "K8-2", "P/C",
          # ì£¼ì†Œ íŒ¨í„´
          "731-", "YMG"
      ]

      # ì—¬ëŸ¬ ë‹¨ì–´ë¡œ êµ¬ì„±ë˜ê±°ë‚˜ ìœ„ì¹˜ ì •ë³´ í¬í•¨
      has_location_info = any(keyword in text for keyword in case_mark_keywords)
      is_multi_word = len(text.split()) > 1 or "-" in text or "/" in text

      return has_location_info or is_multi_word

  ìœ„ì¹˜ ë³€í˜• íŒ¨í„´:

  // íŒ¨í„´ 1: ê°™ì€ ì¤„ì— ìˆëŠ” ê²½ìš° (ê°™ì€ group_id)
  {
    "group_id": "item_00002",
    "labels": [
      {"label": "Shipping line", "text": "C5800002", "bbox": [158, 1311, 169, 50]},
      {"label": "Case mark", "text": "ISHIKAWA EXT:731-48177LOC:K70-4", "bbox": [323,
  1308, 578, 43]}
    ]
  }

  // íŒ¨í„´ 2: ë‹¤ë¥¸ ìœ„ì¹˜ì— ìˆëŠ” ê²½ìš° (ë‹¤ë¥¸ group_id)
  {
    "group_id": "item_00002",
    "labels": [{"label": "Shipping line", "text": "D4700001", "bbox": [2075, 1064, 274,       
  116]}]
  },
  {
    "group_id": "item_00003",
    "labels": [{"label": "Case mark", "text": "YMG KOFU K5-1 40KI 731-48229", "bbox":
  [1639, 1325, 731, 144]}]
  }

  ğŸ“Š ì‹¤ì œ ì¢Œí‘œ ë§¤í•‘ í…Œì´ë¸”

  Order Number ìœ„ì¹˜ íŒ¨í„´

  | í˜ì´ì§€ ìœ í˜•         | Y ì¢Œí‘œ    | X ì¢Œí‘œ      | ì°¸ê³         |
  |----------------|---------|-----------|-----------|
  | Purchase Order | 70-105  | 2163-2183 | ì˜¤ë¥¸ìª½ ìƒë‹¨ ê³ ì • |
  | Delivery Sheet | 100-110 | 2170-2190 | ì˜¤ë¥¸ìª½ ìƒë‹¨ ê³ ì • |

  Case Mark ìœ„ì¹˜ ë³€í˜• (ê°€ì¥ ì£¼ì˜!)

  | ìœ„ì¹˜      | X ì¢Œí‘œ ë²”ìœ„   | Y ì¢Œí‘œ ë²”ìœ„   | ì‹¤ì œ ì‚¬ë¡€    |
  |---------|-----------|-----------|----------|
  | ì™¼ìª½      | 120-140   | 1189-1200 | ê¸°ë³¸ íŒ¨í„´    |
  | ì¤‘ì•™      | 1630-1670 | 1190-1350 | ë³€í˜• íŒ¨í„´    |
  | ì˜¤ë¥¸ìª½     | 2060-2080 | 1330-1570 | íŠ¹ìˆ˜ íŒ¨í„´    |
  | ì™¼ìª½ í…ìŠ¤íŠ¸ë¡œ | 320-350   | 1300-1510 | ì£¼ì†Œ ì •ë³´ íŒ¨í„´ |

  Shipping Line ìœ„ì¹˜ ë³€í˜•

  | ìœ„ì¹˜     | X ì¢Œí‘œ ë²”ìœ„   | Y ì¢Œí‘œ ë²”ìœ„   | ì‹¤ì œ ì‚¬ë¡€     |
  |--------|-----------|-----------|-----------|
  | ì™¼ìª½     | 150-170   | 1300-1320 | 8ìë¦¬ ì½”ë“œ ë‹¨ë… |
  | ì¤‘ì•™     | 690-790   | 1240-1330 | ê¸°ë³¸ íŒ¨í„´     |
  | ì˜¤ë¥¸ìª½ ìƒë‹¨ | 1990-2080 | 1030-1080 | ë³€í˜• íŒ¨í„´     |

  ğŸ” í…ìŠ¤íŠ¸ë³„ bbox í¬ê¸° ì •ë°€ ì¡°ì •

  Part Number í…ìŠ¤íŠ¸ ê¸¸ì´ë³„ width

  part_number_widths = {
      "7ì ì´í•˜": 256,      # "A1126EB"
      "10ì": 256,          # "F9138YA"
      "11ì": 234,          # "A6128HD-01" (SHISAKU ì œì™¸!)
      "20ì": 440,          # "SHISAKU-1_A6075XD-11"
      "21ì": 442,          # "SHISAKU-1_A6128HD-01"
      "ê¸°ë³¸": 256           # ë¶ˆí™•ì‹¤í•œ ê²½ìš°
  }

  Quantity ìˆ«ìë³„ width

  quantity_widths = {
      "1.000 ST": 170,
      "2.000 ST": 170,
      "5.000 ST": 178,
      "6.000 ST": 178,
      "11.000 ST": 192,
      "30.000 ST": 198-223,  # ìœ„ì¹˜ì— ë”°ë¼ ë³€ë™
      "46.000 ST": 195,
      "48.000 ST": 195,
      "100.000 ST": 235
  }

  Unit Price ê°’ë³„ width

  unit_price_widths = {
      "0.0700": 115,
      "0.0800": 115,
      "0.5000": 115,
      "12.3000": 142,
      "46.7500": 142,
      "96.7000": 142,
      "141.9000": 182,
      "259.0600": 146
  }

  ğŸ—ï¸ ê·¸ë£¹ êµ¬ì¡° ê·œì¹™

  ê¸°ë³¸ ê·¸ë£¹ í…œí”Œë¦¿

  {
    "items": [
      {"group_id": "item_00001", "labels": ["Order number"]},
      {"group_id": "item_00002", "labels": ["Case mark", "Shipping line"]},  // ê°™ì€
  ì¤„ì´ë©´ ê°™ì€ ê·¸ë£¹
      {"group_id": "item_00003", "labels": ["Item number", "Part number"]},
      {"group_id": "item_00004", "labels": ["Shipping date", "Quantity", "Unit price"]},      
      {"group_id": "item_00005", "labels": ["Net amount (total)"]}
    ]
  }

  ê·¸ë£¹ ë¶„ë¦¬ ì¡°ê±´

  def should_separate_group(label1_y, label2_y):
      """Y ì¢Œí‘œ ì°¨ì´ê°€ 20px ì´ìƒì´ë©´ ë³„ë„ ê·¸ë£¹"""
      return abs(label1_y - label2_y) > 20

  # ì˜ˆ: Unit priceê°€ ë³„ë„ ì¤„ì— ìˆëŠ” ê²½ìš°
  if should_separate_group(quantity_y, unit_price_y):
      # Quantityì™€ Unit priceë¥¼ ë‹¤ë¥¸ ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¦¬

  âš ï¸ ìì£¼ í‹€ë¦¬ëŠ” ë¶€ë¶„ê³¼ í•´ê²°ì±…

  1. Part Number í…ìŠ¤íŠ¸ ì˜¤ë¥˜

  # âŒ ì˜ëª»ëœ ì˜ˆ
  "SHISAKU-1_A6075XD-11"  # ì‹¤ì œ: "A6075VD-11" (SHISAKU-1_ ë¶ˆí•„ìš”, Xâ†’V)
  "SHISAKU-1_A6128HD-01"  # ì‹¤ì œ: "A6128HD-01" (SHISAKU-1_ ë¶ˆí•„ìš”)

  # âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
  "A6075VD-11"
  "A6128HD-01"

  2. Case Mark ìœ„ì¹˜ ì°©ê°

  # âŒ ì˜ëª»ëœ ì˜ˆ
  assumed_casemark_x = 139  # ìŠµê´€ì ìœ¼ë¡œ ì™¼ìª½ ê°€ì •
  assumed_casemark_y = 1189

  # âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
  # ì‹¤ì œ ì´ë¯¸ì§€ í™•ì¸ í›„
  actual_casemark_x = 1663  # ì¤‘ì•™ì¼ ìˆ˜ë„
  actual_casemark_x = 2072  # ì˜¤ë¥¸ìª½ì¼ ìˆ˜ë„
  actual_casemark_x = 323   # ì£¼ì†Œ ì •ë³´ í…ìŠ¤íŠ¸ì¼ ìˆ˜ë„

  3. Shipping Line êµ¬ë¶„ ì˜¤ë¥˜

  # âŒ ì˜ëª»ëœ ì˜ˆ
  "C5800002 ISHIKAWA EXT:731-48177LOC:K70-4"ë¥¼ í•˜ë‚˜ì˜ Case markë¡œ ì²˜ë¦¬

  # âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
  shipping_line = "C5800002"  # 8ìë¦¬ ì½”ë“œë§Œ
  case_mark = "ISHIKAWA EXT:731-48177LOC:K70-4"  # ë‚˜ë¨¸ì§€ ì£¼ì†Œ ì •ë³´

  4. ë¬¸ì„œ íƒ€ì… í˜¼ë™

  # âŒ ì˜ëª»ëœ ì˜ˆ
  "class": "delivery_sheet"  # Delivery Sheet í˜ì´ì§€ë„

  # âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
  "class": "purchase_order"  # ëª¨ë“  í˜ì´ì§€ í†µì¼

  5. ë¶ˆí•„ìš”í•œ ë¼ë²¨ ì¶”ê°€

  # âŒ ì˜ëª»ëœ ì˜ˆ
  unnecessary_labels = [
      "Special instruction",
      "Part description",
      "Material code",
      "Production instruction receipt section"  # ì‹¤ì œë¡œ ìˆì„ ë•Œë§Œ
  ]

  # âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
  essential_labels_only = [
      "Order number",
      "Case mark",
      "Shipping line",
      "Item number",
      "Part number",
      "Shipping date",  # ë˜ëŠ” "Delivery date"
      "Quantity",
      "Unit price",     # Delivery Sheetì—ëŠ” ì—†ì„ ìˆ˜ ìˆìŒ
      "Net amount (total)"  # Delivery Sheetì—ëŠ” ì—†ì„ ìˆ˜ ìˆìŒ
  ]

  ğŸ”§ ì‹¤ì „ ì ìš© ì›Œí¬í”Œë¡œìš°

  Step 1: ì´ë¯¸ì§€ ë¶„ì„

  def analyze_image(image_path):
      """ê° í˜ì´ì§€ ê°œë³„ ë¶„ì„"""
      checklist = {
          "1. Order number ìœ„ì¹˜": "ì˜¤ë¥¸ìª½ ìƒë‹¨ í™•ì¸ (Y=100 ê·¼ì²˜)",
          "2. 8ìë¦¬ ì½”ë“œ ì°¾ê¸°": "Shipping line ìœ„ì¹˜ í™•ì¸ (ì˜ë¬¸+ìˆ«ì)",
          "3. Case mark í…ìŠ¤íŠ¸": "ì£¼ì†Œ/ìœ„ì¹˜ ì •ë³´ ì‹¤ì œ ìœ„ì¹˜",
          "4. íŠ¹ìˆ˜ ìš”ì†Œ": "ì†ê¸€ì”¨, ìŠ¤íƒ¬í”„, íŠ¹ë³„ ì§€ì‹œì‚¬í•­",
          "5. Part number": "ì •í™•í•œ í…ìŠ¤íŠ¸ (SHISAKU ì œê±°)",
          "6. ìˆ«ì ì •í™•ë„": "Quantity, Price ì •í™•í•œ ê°’",
          "7. í˜ì´ì§€ íƒ€ì…": "Purchase Order vs Delivery Sheet"
      }
      return checklist

  Step 2: í…ìŠ¤íŠ¸ ë¶„ë¥˜

  def classify_text(text):
      """í…ìŠ¤íŠ¸ë¥¼ ë³´ê³  ë¼ë²¨ íƒ€ì… ê²°ì •"""

      # 8ìë¦¬ ì˜ìˆ«ì íŒ¨í„´ í™•ì¸
      if len(text) == 8 and text[0].isalpha() and text[1:].isdigit():
          return "Shipping line"

      # ì£¼ì†Œ/ìœ„ì¹˜ ì •ë³´ íŒ¨í„´ í™•ì¸
      location_indicators = ["YMG", "KOFU", "EXT:", "LOC:", "K5", "K8-2", "-", "/"]
      if any(indicator in text for indicator in location_indicators):
          return "Case mark"

      # ë‚ ì§œ íŒ¨í„´
      if re.match(r'\d{2}-\d{2}-\d{4}', text):
          return "Date"

      # ìˆ˜ëŸ‰ íŒ¨í„´
      if "ST" in text and "." in text:
          return "Quantity"

      return "Unknown"

  Step 3: ì¢Œí‘œ ì¸¡ì •

  def measure_coordinates(element):
      """ì‹¤ì œ í”½ì…€ ì¢Œí‘œ ì¸¡ì •"""
      # ì´ë¯¸ì§€ í¬ê¸°: 2481 x 3510

      # Y ì¢Œí‘œ ê¸°ì¤€ì„ 
      y_references = {
          "order": 100,
          "case_shipping": 1300,
          "item": 1700,
          "date_qty": 1800,
          "total": 2100
      }

      # ì‹¤ì œ ì¸¡ì •ê°’ê³¼ ë¹„êµí•˜ì—¬ ì¡°ì •
      actual_y = measure_actual_y_from_image()

      # 5-10px ì •ë°€ë„ ìœ ì§€
      return {
          "x": actual_x,
          "y": actual_y,
          "width": measure_text_width(element.text),
          "height": standard_height  # ë³´í†µ 42-58
      }

  Step 4: ê²€ì¦

  def validate_json(json_data):
      """ìƒì„±ëœ JSON ê²€ì¦"""
      validations = [
          "Order number Yê°€ 70-105 ë²”ìœ„ì¸ê°€?",
          "8ìë¦¬ ì½”ë“œê°€ Shipping lineìœ¼ë¡œ ë¶„ë¥˜ë˜ì—ˆëŠ”ê°€?",
          "ì£¼ì†Œ/ìœ„ì¹˜ ì •ë³´ê°€ Case markë¡œ ë¶„ë¥˜ë˜ì—ˆëŠ”ê°€?",
          "Part numberì— ë¶ˆí•„ìš”í•œ ì ‘ë‘ì‚¬ê°€ ì—†ëŠ”ê°€?",
          "ê·¸ë£¹ êµ¬ì¡°ê°€ Y ì¢Œí‘œ ìˆœì„œëŒ€ë¡œì¸ê°€?",
          "ëª¨ë“  í•„ìˆ˜ ë¼ë²¨ì´ ìˆëŠ”ê°€?",
          "ë¶ˆí•„ìš”í•œ ë¼ë²¨ì´ ì—†ëŠ”ê°€?"
      ]

      for validation in validations:
          check_validation(validation)

  ğŸ“ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

  FINAL_CHECKLIST = {
      "âœ“ ì´ë¯¸ì§€ í™•ì¸": "ê° í˜ì´ì§€ ì‹¤ì œë¡œ ë´¤ëŠ”ê°€?",
      "âœ“ 8ìë¦¬ ì½”ë“œ": "Shipping lineìœ¼ë¡œ ì˜¬ë°”ë¥´ê²Œ ë¶„ë¦¬í–ˆëŠ”ê°€?",
      "âœ“ ì£¼ì†Œ/ìœ„ì¹˜ ì •ë³´": "Case markë¡œ ì˜¬ë°”ë¥´ê²Œ ë¶„ë¥˜í–ˆëŠ”ê°€?",
      "âœ“ ì¢Œí‘œ ì •ë°€ë„": "5-10px ë‹¨ìœ„ê¹Œì§€ ì •í™•í•œê°€?",
      "âœ“ í…ìŠ¤íŠ¸ ì •í™•ë„": "ì˜¤íƒ€ë‚˜ ë¶ˆí•„ìš”í•œ ì¶”ê°€ ì—†ëŠ”ê°€?",
      "âœ“ ê·¸ë£¹ êµ¬ì¡°": "Y ì¢Œí‘œ ê¸°ì¤€ ì˜¬ë°”ë¥¸ê°€?",
      "âœ“ ë¬¸ì„œ íƒ€ì…": "purchase_orderë¡œ í†µì¼í–ˆëŠ”ê°€?",
      "âœ“ í…œí”Œë¦¿ íƒˆí”¼": "íŒ¨í„´ ì˜ì¡´ ì—†ì´ ì‹¤ì œ ì¸¡ì •í–ˆëŠ”ê°€?"
  }

  ğŸ¯ í•µì‹¬ êµí›ˆ

  1. ì ˆëŒ€ ì´ë¯¸ì§€ë¥¼ ë³´ì§€ ì•Šê³  ì‘ì—…í•˜ì§€ ë§ ê²ƒ
  2. 8ìë¦¬ ì˜ìˆ«ì íŒ¨í„´ì´ Shipping line
  3. ì£¼ì†Œ/ìœ„ì¹˜ ì •ë³´ê°€ Case mark
  4. ê° í˜ì´ì§€ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì¸¡ì •
  5. íŒ¨í„´ì€ ì°¸ê³ ìš©, ì‹¤ì œ ì¸¡ì •ì´ ì§„ì‹¤